[
    "<p> ",
    "<strong>",
    "Part",
    "I: Generation of raw replication timing datasets</strong> ",
    " ",
    "<p><strong>PROTOCOL 1.",
    "BrdU labeling and staining of cells for FACS</strong></p> ",
    " ",
    "<p>",
    "This protocol can be performed using PI staining and ethanol fixation prior to sorting \\(<strong>option A</strong>), or, for cells that break or clump in ethanol, by collecting cells following pulse labeling with BrdU and treating with a DAPI staining solution containing Triton X-100 to permeabilize cell membranes \\(<strong>option B</strong>).  ",
    "The drawback of option B is that cells need to be sorted immediately following staining.</p> ",
    " ",
    "<p><strong>A. Labeling and PI staining of cells for FACs following ethanol fixation - TIMING 3.5 h</strong></p> ",
    " ",
    "<p>1.",
    "For adherent cells, remove cell culture medium and replenish with fresh medium.    ",
    "Add BrdU at a final concentration of 50\u00b5M.  For suspension cells, add BrdU to the cell culture medium at a final concentration of 50\u00b5M.<br /> ",
    "2.",
    "Incubate cells for two hours in a carbon dioxide incubator at 37\u00baC, 5% CO<sub>2</sub>.<br /> \r\n  3.",
    "For adherent cells, rinse gently with ice-cold PBS twice.",
    "For suspension cells, collect cells  in a 15mL tube and proceed directly to step 6.<br /> \r\n  4. Detach adherent cells using 0.2X Trypsin-EDTA for 2-3 minutes or Accutase for 3-6 minutes.<br /> \r\n  ",
    "<strong>CRITICAL STEP</strong> Incubate cells at 37 \u00baC with the enzyme treatment and/or use gentle trituration if necessary to achieve a single cell suspension, as this is necessary for accurate FACS sorting.<br /> ",
    "5.",
    "Add 5mL of cell culture medium \\(containing FBS if trypsin has been used) to the cell culture dish or flask, pipette gently, and transfer contents to a 15mL round bottom tube.<br /> \r\n  ",
    "6.",
    "Count the number of cells collected using a  hemacytometer.<br /> \r\n  7.",
    "Centrifuge at approximately 200 <em>g</em> for 5 minutes.<br /> \r\n  8.",
    "Aspirate supernatant carefully and resuspend cells in 2.5 mL of ice-cold PBS containing 1% FBS.<br /> \r\n  9.",
    "Add 7.5 mL of ice-cold 100% ethanol dropwise while gently vortexing.<br /> \r\n  <strong>CRITICAL STEP</strong>",
    "Note that gentle vortexing is required.<br /> ",
    "10.",
    "Seal the cap of the 15 mL tube with parafilm and mix gently but thoroughly.<br /> \r\n  11.",
    "<strong>PAUSE POINT</strong>",
    "Proceed to the next step to begin PI staining or stop here and store tubes in the dark at -20\u00baC indefinitely.<br /> \r\n  12.",
    "Resuspend the BrdU-labeled, ethanol fixed cells by tapping and inverting the tube.<br /> \r\n  13.",
    "Transfer 4 &#215; 10<sup>6</sup> - 8 &#215; 10<sup>6</sup> cells to a 5 mL polystyrene round bottom tube.<br /> \r\n  14.",
    "Centrifuge at approximately 200 <em>g</em> for 5 minutes.<br /> \r\n  15.",
    "Decant supernatant carefully<br /> \r\n  16.",
    "Add 2 mL of PBS with 1% FBS and mix well by tapping the tube.<br /> \r\n  17.",
    "Centrifuge at approximately 200 <em>g</em> for 5 minutes.<br /> \r\n  18.",
    "Decant supernatant carefully.<br /> \r\n  19.",
    "Resuspend cell pellet in PBS with 1% FBS to achieve a solution of 3 &#215; 10<sup>6</sup> cells/mL.<br /> \r\n  20.",
    "Add 1mg/mL propidium iodide to a final concentration of 50 \u00b5g mL.<br /> \r\n  21.",
    "Add 10 mg/mL",
    "RNase A to a final concentration of 250 \u00b5g/mL.<br /> \r\n  22.",
    "Tap the tube to mix and incubate for 20 to 30 minutes at room temperature in the dark.<br /> \r\n  23.",
    "Filter cells by pipeting them through 37 micron nylon mesh into a 5 mL polystyrene round bottom tube.<br /> \r\n  24.",
    "Keep samples on ice in the dark and proceed directly to FACS sorting.</p> \r\n   ",
    "<p><strong>B. BrdU labeling and DAPI staining of cells for FACS - TIMING 3 h</strong></p> ",
    " ",
    "<p>1.",
    "Remove cell culture medium from growing cells and replace with cell culture medium containing BrdU at a final concentration of 50uM.<br /> ",
    "2.",
    "Incubate cells for two hours in a carbon dioxide incubator at 37\u00baC, 5% CO<sub>2</sub>.<br /> \r\n  3.",
    "Rinse adherent cells gently with ice-cold PBS twice.<br /> \r\n  4. Detach adherent cells using 0.2X Trypsin-EDTA for 2-3 minutes or Accutase for 3-6 minutes.<br /> \r\n  <strong>CRITICAL STEP</strong>",
    "Incubate cells at 37 \u00baC with the enzyme treatment and/or use gentle trituration if necessary to achieve a single cell suspension, as this is necessary for accurate FACS sorting<br /> ",
    "5.",
    "Add 5mL of cell culture medium \\(containing FBS if trypsin has been used) to the cell culture dish or flask, pipette gently, and transfer contents to a 15mL tube.  ",
    "Count the number of cells collected using a hemacytometer.<br /> \r\n  6.",
    "Centrifuge at approximately 200 <em>g</em> for 5 minutes.<br /> \r\n  7.",
    "Aspirate the supernatant carefully.<br /> \r\n  8.",
    "Add 5mL of ice-cold PBS and pipette gently but thoroughly.<br /> \r\n  9.",
    "Centrifuge at approximately 200 <em>g</em> for 5 minutes.<br /> \r\n  10.",
    "Aspirate supernatant carefully.<br /> \r\n  11.",
    "Resuspend the cell pellet in DAPI staining solution \\(1 X PBS with 0.1% Triton X-100  and 2\u00b5g/mL DAPI) to achieve a solution of 5 &#215; 10<sup>6</sup> \u2013 10 &#215; 10<sup>6</sup> cells/mL.<br /> \r\n  12.",
    "Filter cells by pipeting them through 37 micron nylon mesh into a 5 mL polystyrene round bottom tube.<br /> \r\n  13.",
    "Keep samples on ice in the dark and proceed directly to FACS sorting.</p> \r\n   ",
    "<p><strong>PROTOCOL 2.",
    "FACS sorting fractions of S-phase - TIMING 1 h</strong></p> ",
    " ",
    "<p>",
    "This protocol describes the use of flow cytometry to sort cells based on DNA content.  ",
    "Electrostatic sorting is performed as described here on a BD \\(Becton-Dickinson) FACS Aria flow cytometer.  ",
    "During FACS analysis forward and side scatter analyses should be used to select an appropriate population of cells free of doublets or cell debris, both of which can hinder accurate sorting of desired populations.  ",
    "Lasers used in this protocol include 488 Blue to detect PI or 407 Violet to detect DAPI in cells that have been stained for DNA content.  ",
    "Two separate fractions of S phase, early and late, are chosen to be collected, but more can be collected if desired<sup>9,10</sup>.</p> ",
    " ",
    "<p>1.",
    "Run sample on FACS Aria cell sorter \\(Any comparable cell sorter can be used)<br /> ",
    "<strong>CRITICAL STEP</strong>",
    "It is very important to keep all samples chilled on ice or at 4\u00baC during FACS analysis to avoid cell cycle progression in the absence of BrdU.  Protect samples from light.<br /> ",
    "2.",
    "Use forward and side scatter information to select the desired population of cells to be included in the sort.<br /> \r\n  3.",
    "Create a histogram that plots cell count on the y-axis and DNA content \\(fluorochrome intensity) on the x-axis.  ",
    "See <strong>",
    "Fig.1A</strong><br /> \r\n  4.",
    "Select two distinct S-phase populations to be sorted into separate fractions as indicated in Fig.1.<br /> \r\n  5.",
    "Store cell immediately on ice in the dark until all samples have been sorted.  ",
    "Cells are sorted into fresh 5ml round bottom tubes and kept at 4\u00baC during the sort.<br /> \r\n  6.",
    "Centrifuge at 400g for 10 minutes at 4\u00baC.  ",
    "Alternatively, if fewer than 150,000 cells have been collected for each fraction, proceed directly to step 8.<br /> \r\n  ",
    "7.",
    "Decant supernatant gently, only once.<br /> \r\n  <strong>CRITICAL STEP</strong>",
    "The cell pellet can easily become loose.",
    "Some residual sheath fluid can be left in the tube.<br /> ",
    "8.",
    "Add 1 mL of SDS-PK buffer containing 0.2mg/mL Proteinase K and 0.05mg/mL<br /> \r\n  glycogen for every 100,000 cells collected and mix vigorously by tapping the tube.<br /> ",
    "9.",
    "Incubate samples in a 56\u00baC water bath for 2 hours.<br /> \r\n  10.",
    "Mix sample thoroughly and aliquot 200\u00b5l, equivalent to approximately 20,000 cells, per 1.5 mL tube.<br /> \r\n  11.",
    "Stop here and store samples at -20\u00baC in the dark or proceed directly to step 12.<br /> \r\n  <strong>PAUSE POINT</strong>",
    "Samples can be stored for at least 6 months before use.<br /> ",
    "12.",
    "Add 200\u00b5l SDS-PK buffer with 0.05mg/mL glycogen to each aliquot and proceed<br /> \r\n  directly to BrdU immunoprecipitation.</p> ",
    " ",
    "<p><strong>PROTOCOL 3.  ",
    "BrdU immunoprecipitation - TIMING 2 d</strong></p> ",
    " ",
    "<p>",
    "This protocol begins with cells that have been pulse labeled with BrdU and sorted into different cell cycle stages by FACS.",
    "Here DNA from these cells is sonicated into fragments ranging from 250bp to 2kb and then immunoprecipitated using an anti-BrdU antibody.  ",
    "Immunoprecipitated DNA is then purified and ready for use in further steps of replication timing analysis for a time period of up to one month.  ",
    "If samples have been stored at -20\u00baC prior to beginning the immunopreciptation, thaw samples in a 56\u00baC water bath and add 200\u00b5l of SDS-PK Buffer pre-warmed to 56\u00baC with 0.05mg/mL glycogen to each sample prior to performing the phenol-chloroform extraction in step 13.</p> ",
    " ",
    "<p>13.",
    "Extract once with phenol-chloroform, collecting the upper phase in a 1.5mL tube.<br /> ",
    "14.",
    "Extract once with chloroform, collecting the upper phase in a 1.5mL tube.<br /> \r\n  15.",
    "Add 1 volume of isopropanol and mix well.<br /> \r\n  16.",
    "Store at -20\u00baC for 20 minutes.<br /> \r\n  17.",
    "Centrifuge at 16.1 <em>g</em> for 30 minutes at 4\u00baC.<br /> \r\n  18.",
    "Discard the supernatant and add 750\u00b5l 70% ethanol to the pellet<br /> \r\n  19.",
    "Centrifuge at 16.1 <em>g</em> for 5 minutes at 4\u00baC, then remove all ethanol and let the pellet dry.<br /> \r\n  20.",
    "Resuspend the pellet in 500\u00b5l 1x TE.<br /> \r\n  <strong>PAUSE POINT</strong> Stop here and store overnight   at 4\u00baC or proceed directly to step 21.<br /> ",
    "21.",
    "Sonicate DNA to an average size of ~0.7-0.8 kb.<br /> \r\n  22.",
    "Incubate sample at 95\u00baC for 5 minutes to heat denature.<br /> \r\n  23.",
    "Cool sample on ice for 2 minutes.<br /> \r\n  24.",
    "Add 60\u00b5l of 10X IP Buffer to a clean 1.5mL tube.<br /> \r\n  25.",
    "Add the denatured DNA to the tube containing 60\u00b5l 10X IP Buffer.<br /> \r\n  26.",
    "Add 40\u00b5l of 12.5 \u00b5g/ml anti-BrdU antibody.<br /> \r\n  27.",
    "Incubate for 20 minutes at room temperature with constant rocking.<br /> \r\n  <strong>CRITICAL STEP</strong>",
    "Foil tubes to keep samples in the dark.<br /> ",
    "28.",
    "Add 20\u00b5g of rabbit anti-mouse IgG.<br /> \r\n  <strong>CRITICAL STEP</strong>",
    "Foil tubes to keep samples in the dark.<br /> ",
    "29.",
    "Incubate for 20 minutes at room temperature with constant rocking.<br /> \r\n  30.",
    "Centrifuge at 16.1 <em>g</em> for 5 minutes at 4\u00baC<br /> \r\n  31.",
    "Remove supernatant completely.<br /> \r\n  <strong>CRITICAL STEP</strong>",
    "If pellet becomes loose, then centrifuge sample again in order to completely remove the supernatant without disturbing the pellet.  ",
    "Several centrifugations may be necessary to completely remove supernatant.<br /> ",
    "32.",
    "Add 750\u00b5l of 1X IP Buffer that has been chilled on ice.<br /> \r\n  33.",
    "Centrifuge at 16.1 <em>g</em> for 5 minutes at 4\u00baC.<br /> \r\n  34.",
    "<strong>CRITICAL STEP</strong>",
    "Remove supernatant completely, as in step 31.<br /> \r\n  35.",
    "Resuspend the pellet in 200\u00b5l digestion buffer with freshly added 0.25mg/mL proteinase K.<br /> \r\n  <strong>PAUSE POINT</strong>",
    "Incubate samples overnight at 37\u00baC.<br /> ",
    "36.",
    "Add 100\u00b5l of fresh digestion buffer with freshly added 0.25mg/mL proteinase K.<br /> \r\n  37.",
    "Incubate samples for 60 minutes at 56\u00baC.<br /> \r\n  38.",
    "Extract once with phenol-chloroform, collecting the upper phase in a 1.5mL tube.<br /> \r\n  39.",
    "Extract once with chloroform, collecting the upper phase in a 1.5mL tube.<br /> \r\n  40.",
    "Add 0.625\u00b5l of 20mg/mL glycogen, 100\u00b5l of 10 M ammonium acetate, and 750\u00b5l of 100% ethanol and mix well.<br /> \r\n  41.",
    "Store at -20\u00baC for 20 minutes.<br /> \r\n  42.",
    "Centrifuge at 16.1 <em>g</em> for 30 minutes at 4\u00baC.<br /> \r\n  43.",
    "Remove supernatant, rinse pellet with 70% ethanol and dry.<br /> \r\n  44.",
    "Resuspend the pellet in 80\u00b5l 1X TE.<br /> \r\n  <strong>PAUSE POINT</strong>",
    "Store DNA at 4\u00baC for up to one month.</p> ",
    " ",
    "<p><strong>Quality control check of early and late S-phase DNA</strong></p> ",
    " ",
    "<p>To ensure quality, BrdU-IPs are screened by PCR amplification using primers specific to DNA markers of known relative replication time \\(i.e.",
    "early or late).  ",
    "As PCR results can vary between aliquots of the same sample and replication timing changes during development<sup>2,3</sup>, consistency across multiple samples from the same cell type is the most reliable way to assess the quality of IP samples.",
    "Among the mouse sequences listed below, mitochondrial DNA replicates throughout the cell cycle<sup>11</sup> and is equally represented in early and late S-phase fractions.",
    "Alpha-globin, Pou5f1 and Mmp15 are generally early replicating markers, whereas beta-globin, Zfp42, Dppa2, Ptn, Mash1, and Akt3 are generally late replicating markers.",
    "Zfp42 and Dppa2 are early replicating in ESCs whereas they are late replicating in all somatic cell types examined to date.",
    "Among the human sequences listed below, mitochondrial DNA is equally represented in early and late S-phase fractions, while alpha-globin, MMP15 and BMP1 are generally early replicating markers.",
    "PTGS2, NETO1, SLITRK6, ZFP42 and DPPA2 are generally late replicating.",
    "Markers amplified, sizes and primer sequences are as follows:</p> ",
    " ",
    "<p><strong>Mouse test regions</strong></p> ",
    " ",
    "<p>Intergenic mitochondrial DNA, 346 bp<br /> ",
    "Forward 5'-GACATCTGGTTCTTACTTCA-3'<br /> ",
    "Reverse 5'-GTTTTTGGGGTTTGGCATTA-3'</p> ",
    " ",
    "<p>Alpha-globin, 439 bp<br /> ",
    "Forward 5'-AAGGGGAGCAGAGGCATCA-3'<br /> ",
    "Reverse 5'-AGGGCTTGGGAGGGACTG-3'</p> ",
    " ",
    "<p>Beta-globin, 369 bp<br /> ",
    "Forward 5'-CAGTAAGCCACAGATCCTATTG-3'<br /> ",
    "Reverse 5'-CCCATAGTGACTATTGACTGTG-3'</p> ",
    " ",
    "<p>Pou5f1, 194 bp",
    "<br /> ",
    "Forward 5'-CCCTCCCTAAGTGCCAGTTTCT-3'<br /> ",
    "Reverse 5'-GTAATCGCCCTCAGCAGTGTCT-3'</p> ",
    " ",
    "<p>Mmp15, 360 bp<br /> ",
    "Forward 5'-AACAGAAGGCCTGCCTTGAC-3'<br /> ",
    "Reverse 5'-TGCATAGCACGACAGCATTG-3'</p> ",
    " ",
    " ",
    "<p>Zfp42, 211 bp<br /> ",
    "Forward 5'-TGAGATTAGCCCCGAGACTGAG-3'<br /> ",
    "Reverse 5'-CGTCCCCTTTGTCATGTACTCC-3'</p> ",
    " ",
    "<p>Dppa2, 199 bp<br /> ",
    "Forward 5'-CCACAGGAAGACAGGAAGCAGT-3'<br /> ",
    "Reverse 5'-AGCCAGACAGGAGCCCTAGAGT-3'</p> ",
    " ",
    "<p>Ptn, 230 bp<br /> ",
    "Forward 5'-CTGGAATGAGTTACTGACGGGG-3'<br /> ",
    "Reverse 5'-CTGGCCCCACTGTGTAATAAGC-3'</p> ",
    " ",
    "<p>Mash1, 182 bp<br /> ",
    "Forward 5'-GAAGATGAGCAAGGTGGAGACG-3'<br /> ",
    "Reverse 5'-AGTAGGACGAGACCGGAGAACC-3'</p> ",
    " ",
    "<p>Akt3, 173 bp<br /> ",
    "Forward 5'-GAAGTGTGGGTTGAACCTCTGG-3'<br /> ",
    "Reverse 5'-GCACCCTCTCCACTGTTCTGAT-3'</p> ",
    " ",
    "<p><strong>Human test regions</strong></p> ",
    " ",
    "<p>Intergenic mitochondrial DNA, 168 bp<br /> ",
    "Forward 5'-CCTAGGAATCACCTCCCATTCC-3'<br /> ",
    "Reverse 5'-GTGTTTAAGGGGTTGGCTAGGG-3'</p> ",
    " ",
    "<p>Alpha-globin, 257 bp<br /> ",
    "Forward 5'-GACCCTCTTCTCTGCACAGCTC-3'<br /> ",
    "Reverse 5'-GCTACCGAGGCTCCAGCTTAAC-3'</p> ",
    " ",
    "<p>Beta-globin, 241 bp<br /> ",
    "Forward 5'-CCTGAGGAGAAGTCTGCCGTTA-3'<br /> ",
    "Reverse 5'-GAACCTCTGGGTCCAAGGGTAG-3'</p> ",
    " ",
    "<p>MMP15, 249 bp<br /> ",
    "Forward 5'-CAGGCCTCTGGTCTCTGTCATT-3'<br /> ",
    "Reverse 5'-AGAGCTGAGAAACCACCACCAG-3'</p> ",
    " ",
    "<p>BMP1, 177 bp<br /> ",
    "Forward 5'-GATGAAGCCTCGACCCCTAGAT-3'<br /> ",
    "Reverse 5'-ACCCGTCAGAGACGAACTTGAG-3'</p> ",
    " ",
    "<p>hPTGS2, 230 bp<br /> ",
    "Forward 5'-GTTCTAGGCTGGTGTCCCATTG-3'<br /> ",
    "Reverse 5'-CTTTCTGTACTGCGGGTGGAAC-3'</p> ",
    " ",
    "<p>hNETO1,",
    "286 bp<br /> ",
    "Forward 5'-GGAGGTGGAATGCTAGGGACTT-3'<br /> ",
    "Reverse 5'-GCTGAGTGTGGCCTTAAGAGGA-3'</p> ",
    " ",
    "<p>hSLITRK6, 281 bp<br /> ",
    "Forward 5'-GGAGAACATGCCTCCACAGTCT-3'<br /> ",
    "Reverse 5'-GTCCTGGAAGTTGAGTGGATGG-3'</p> ",
    " ",
    "<p>hZFP42, 233 bp",
    "<br /> ",
    "Forward 5'-CTTGTGGGGACACCCAGATAAG-3'<br /> ",
    "Reverse 5'-AACCACCTCCAGGCAGTAGTGA-3'</p> ",
    " ",
    "<p>hDPPA2, 168bp<br /> ",
    "Forward 5'-AGGTGGACAGCGAAGACAGAAC-3'<br /> ",
    "Reverse 5'-GGCCATCAGCAGTGTCCTAAAC-3'</p> ",
    " ",
    " ",
    "<p><strong>PROTOCOL 4.",
    "PCR method for quality control of BrdU-immunoprecipitation - TIMING 5 h</strong></p> ",
    " ",
    "<p>45.",
    "Prepare enough PCR master-mix to screen all IP samples with each primer set.",
    "Each reaction requires:</p> ",
    " ",
    "<p>9.63 uL nuclease free water<br /> ",
    "1.25 uL",
    "10X Buffer<br /> ",
    "0.25 uL",
    "10mM dNTPs<br /> ",
    "0.06 uL",
    "X U/mL Taq Polymerase<br /> ",
    "0.31 uL",
    "F/R 20uM combined primers*****</p> ",
    " ",
    "<p>46.",
    "Aliquot 11.5 uL master-mix per tube and add 1 uL IP sample.<br /> ",
    "47.",
    "Run samples in thermocycler with an initial denaturation step of 94\u02daC for 2 min, followed by 38 cycles of 94\u02daC for 45 sec, 60\u02daC for 45 sec and 72\u02daC for 2 min, and then a final elongation step of  72\u02daC for 5 min.<br /> \r\n  48.",
    "Add 2.5 uL 6x loading dye to every 12.5 uL reaction and load 6 uL onto 1.5% agarose gel.<br /> \r\n  49.",
    "Score each IP based on anticipated enrichment of amplicon DNA.<br /> \r\n  <strong>CRITICAL STEP</strong>",
    "Before proceeding, verify sample quality with corresponding primer sets listed above.<br /> ",
    "50.",
    "If several IPs of the same sample and S-phase fraction pass the screening, pool equal amounts of each IP to a final volume of 50 uL \\(e.g.",
    "If two IP pass, combine 25 uL of each to pool).</p> \r\n   ",
    "<p>***** Mitochondrial primer sets should be used at 1.0 uM concentration instead of 0.5 uM. For this master-mix add 0.63 uL F/R 20uM combined primers and 9.31 uL nuclease-free water per reaction.</p> ",
    " ",
    "<p><strong>PROTOCOL 5.",
    "Whole Genome Amplification - TIMING 8 h</strong></p> ",
    " ",
    "<p>Once purified by immunoprecipitation and screened for sample quality, BrdU incorporated DNA must be amplified  to obtain sufficient amounts for array hybridization.",
    "If multiple samples pass PCR screening, DNA from parallel immunoprecipitations can be pooled together and used as the starting material for whole genome amplification.",
    "Otherwise, a single screened immunoprecipitation is used.",
    "Whole genome amplification \\(WGA) is performed using GenomePlex Complete Whole Genome Amplification Kit \\(Sigma Catalog Number WGA2) followed by GenomePlex WGA Reamplification Kit \\(Sigma Catalog Number WGA3).",
    "Amplified samples are then  loaded onto a gel to determine size range and screened once more by PCR to ensure no bias was introduced during amplification.</p> ",
    " ",
    "<p>51.",
    "Precipitate DNA fractions by adding 1.25 uL 2 mg/mL glycogen, 20 uL 10M ammonium acetate and 150 uL ethanol to each 50 uL IP sample \\(If pooling multiple samples, 50 uL total volume should still be used).",
    "Mix well, let stand at -20\u02daC for 20 min, then centrifuge for 30 min at max speed and 4\u02daC.<br /> ",
    "52.",
    "Rinse pellets with 70% ethanol, air dry and resuspend in 10 uL nuclease free water.<br /> \r\n  53.",
    "Transfer the 10uL samples to 0.2 mL PCR tubes and follow GenomePlex Complete Whole Genome Amplification Kit \\(Sigma Catalog Number WGA2) procedure from the Library Preparation step \\(i.e.",
    "skip Fragmentation)<sup>12</sup>.<br /> \r\n  54.",
    "Purify entire WGA products using QIAquick PCR Purification Kit \\(Qiagen Catalog Number 28106).",
    "Elute in 30 uL nuclease free water pre-warmed to 65\u02daC and determine concentration using Nanodrop.<br /> \r\n  55.",
    "Dilute WGA samples to appropriate concentration \\(we use 1 uL DNA of 20 ng/uL) and follow GenomePlex WGA Reamplification Kit \\(Sigma Catalog Number WGA3)",
    "Reamplification Procedure A.<br /> \r\n  56.",
    "Purify entire reamplified WGA products using QIAquick PCR Purification Kit as done in step 54.<br /> \r\n  57.",
    "Screen purified final products using same PCR method used to screen BrdU-IPs as described in protocol 4.</p> \r\n   ",
    "<p><strong>PROTOCOL 6.",
    "S/G1 FACS",
    "Sorting \\(Alternative to Steps 1-57) - TIMING 1 d</strong></p> ",
    " ",
    "<p>In this method, cells are sorted into two fractions, G1 phase and S phase, based on DNA content, and replication timing is derived from the 2-fold copy number increase for early vs. late replicating sequences in pure S-phase populations.  ",
    "DNA analysis using flow cytometry can be performed simply by the use of a single DNA-binding fluorescent dye such as PI or DAPI as originally described.  ",
    "The advantage of this method is that it eliminates the need for BrdU-IP and whole genome amplification steps \\(described below), which need to be carefully controlled.",
    "However, direct comparisons have shown that this method produces a lower signal to noise ratio than protocol 1<sup>1</sup>.</p> ",
    " ",
    "<p>58.",
    "For adherent cells, remove cell culture medium from exponentially growing cells and replace with cell culture medium containing BrdU at a final concentration of 10 uM.   For suspension cells, add BrdU to the cell culture medium at a final concentration of 10\u00b5M.",
    "In order to obviate the amplification step prior to labeling and array hybridization, start with 6 million cells.",
    "One should also prepare a small sample of non BrdU-labeled, EtOH-fixed cells for PI-only control and set aside a small number of BrdU-labeled cells for BrdU-only control.<br /> ",
    "59.",
    "Incubate cells for 30 minutes in a carbon dioxide incubator at 37\u00baC, 5% CO2<br /> \r\n  60.",
    "Fix as in protocol 1, steps 3-11.<br /> \r\n  <strong>PAUSE POINT</strong>",
    "Cells can be stored as in protocol 1<br /> ",
    "61.",
    "Aliquot \\(multiples of) &lt; 3 &#215; 10<sup>6</sup> cells in a 1.5mL tube\\(s), centrifuge for 5 min., 200 <em>g</em> at room temperature.",
    "Centrifugation and removal of supernatant is much easier with 1.5 mL tubes as the pellets are very loose.<br /> \r\n  62.",
    "Aspirate supernatant completely with P200.",
    "\\(will be effective if spun down ~3 sec once again to discard residual supernatant \u2013 same for all aspiration procedures below)<br /> \r\n  63.",
    "Loosen pellet by brief vortexing.<br /> \r\n  64.",
    "Add 1ml of 0.1M HCl/0.5% Triton X-100, resuspend by tapping.<br /> \r\n  65.",
    "Incubate 15 min, room temperature in the dark.<br /> \r\n  66.",
    "Centrifuge 5 min, 200 <em>g</em> at room temperature, then aspirate supernatant completely.<br",
    "/",
    "> \r\n  67.",
    "Add 1ml of 0.1M Sodium Tetraborate and resuspend by tapping.<br /> \r\n  68.",
    "Centrifuge 5 min, 200 <em>g</em> at room temperature, then aspirate supernatant completely.<br /> \r\n  69.",
    "Add 0.15 \u00b5g anti-BrdU antibody in 0.5 ml 0.5% Tween20/1% BSA/PBS and resuspend by tapping.<br /> \r\n  70.",
    "Incubate for 30 min at room temperature in the dark.<br /> \r\n  71.",
    "Centrifuge 5 min, 200 <em>g</em> at room temperature, then aspirate supernatant completely.<br",
    "/> \r\n  72.",
    "Add 0.5 ml of 0.5% Tween20/1% BSA/PBS.<br /> \r\n  73.",
    "Centrifuge 5 min, 200 <em>g</em> at room temperature, then aspirate supernatant completely.<br",
    "/",
    "> \r\n  74.",
    "Add 1 \u00b5g anti-Mouse IgG-AlexaFluor488 in 100 \u00b5l 0.5% Tween20/1% BSA/PBS and resuspend by tapping \\(or when 1-2 &#215; 10<sup>6</sup> cells are used, add 0.5 \u00b5g anti-Mouse IgG-AlexaFluor488 in 50 \u00b5l).<br /> \r\n  75.",
    "Incubate for 30 min at room temperature in the dark.<br /> \r\n  76.",
    "Centrifuge 5 min, 200 <em>g</em> at room temperature, then aspirate supernatant completely.<br",
    "/> \r\n  77.",
    "Add 0.5 ml of 0.5% Tween20/1% BSA/PBS.<br /> \r\n  78.",
    "Centrifuge 5 min, 200 <em>g</em> at room temperature, then aspirate supernatant completely.<br",
    "/> \r\n  79.",
    "Resuspend the pellet in 1 ml of 5\u00b5g/ml PI in PBS \\(For \u201cBrdU-only\u201d control, just add PBS).<br /> \r\n  80.",
    "Transfer to a round bottom 5mL tube \\(i.e.",
    "Falcon 2054).<br /> \r\n  81.",
    "Adjust concentration to 2 &#215; 10<sup>6</sup> /ml by adding 5 \u00b5g/ml PI in PBS<br /> \r\n  82.",
    "Bring to flow lab for sorting \\(on ice, dark)<br /> \r\n  83.",
    "Filter with 37 \u00b5m mesh filter.</p> \r\n   ",
    "<p><strong>PROTOCOL 7.",
    "Labeling and hybridizing - TIMING 1-3 d</strong></p> ",
    " ",
    "<p>",
    "In order to avoid the ambiguity inherent to generalized methods, this protocol is based specifically on NimbleGen products.",
    "During our earliest attempts to profile replication timing genome-wide, NimbleGen outperformed other platforms we tested and became our platform of choice.",
    "Others have successfully applied this method to additional platforms<sup>13,14</sup>, including deep sequencing of BrdU-IP DNA<sup>15</sup>.",
    "Currently, mammalian replication timing data generated from microarray hybridization and deep sequencing is of equal quality<sup>1, 3</sup>, while the microarray method remains more cost-effective and the bioinformatics are considerably less demanding for the typical laboratory.",
    "Future advances reducing BrdU-labeling times and sequencing limitations may make this method more worthwhile and accessible<sup>16</sup>.</p> ",
    " ",
    "<p>84.",
    "Differentially label reamplified early and late WGA DNA fractions with Cy3 and Cy5 dyes following the Sample Labeling Instructions for NimbleGen Dual-Color DNA Labeling Kit \\(cat.",
    "no. 05223547001).",
    "Briefly, 1 ug of early or late replicating DNA is labeled with either Cy5 or Cy3 random 7-mer dyes by Klenow reaction, precipitated with isopropanol, and resuspended in nuclease-free water and quantified.",
    "As instructed, combine equal quantities of labeled early and late fraction DNA \\(specific quantity will depend upon array design).</p> ",
    " ",
    "<p>85.",
    "Transfer labeled samples to hybridization buffer, denature at 95\u00baC for 5 min, prepare array\\(s) with appropriate mixer\\(s) \\(specific mixer will depend upon array design), load samples on array\\(s) and hybridize using NimbleGen Hybridization Kit \\(cat.",
    "no. 05583683001) at 42\u00baC for 24 to 72 hours depending on the array feature size.</p> ",
    " ",
    "<p>86.",
    "Following Hybridization, wash array\\(s) as directed using NimbleGen Wash Buffer Kit \\(cat.",
    "no.",
    "05584507001).</p> ",
    " ",
    "<p>87.",
    "Scan array\\(s) and save images as .tif files using appropriate NimbleGen microarray scanner and software package.",
    "Open .tif files in NimbleScan software, overlay grid on the scanned image \\(i.e.",
    "grid cells correspond to probes), and generate two .pair files per experiment, which contain the signal intensity of all probes on the array for either Cy3 or Cy5, for normalization and downstream analysis.",
    "Specific instructions for these steps can be found in NimbleGen Arrays User\u2019s Guide, CGH Analysis.</p> ",
    " ",
    "<p>88.",
    "If desired, arrays can be stripped for reuse using NimbleGen Array Reuse Kit 40 \\(contact NimbleGen customer service for ordering information).",
    "Scan array to confirm successful stripping.</p> ",
    " ",
    "<p><strong>Part II:  Normalization and computational analysis of replication timing datasets</strong></p> ",
    " ",
    "<p>",
    "In this section of the protocol we focus on computational methods for analyzing replication timing using whole-genome comparative genome hybridization \\(CGH) microarrays, using the R framework for statistical computing<sup>8-10</sup> Additional help on using R can be found at <a href=\"http://cran.r-project.org/\">http://cran.r-project.org/</a>.</p> ",
    " ",
    "<p>For normalization, we use the R package LIMMA \\(linear models for microarray data), also available with a user interface through the limmaGUI package, for normalization and scaling<sup>17,18</sup>.  Methods for verifying the quality of array data produced are covered in quality control \\(QC) sections 1-6,  summarized in <strong>",
    "Fig.3</strong>.</p> ",
    " ",
    "<p><strong>1.)",
    "Create RGL files from the original NimbleGen .pair",
    "files.</strong>  These \"Red-Green lists\" contain columns for both red \\(Cy5) and green \\(Cy3) channel signal intensities.  ",
    "Note that the genomic position column may need to be set as numeric manually with classes\\[x] = \"numeric\" \\(where x is the column number containing position information) after line 2.</p> ",
    " ",
    "<p>1| tab5rows &lt;- read.delim\\(\"318990_4L1210LymphoblastP1_532.pair\", header = TRUE, nrows = 5, skip=1)<br /> ",
    "2| classes &lt;- sapply\\(tab5rows, class)<br /> ",
    "3| mLymph1Cy3 &lt;- read.delim\\(\"318990_4L1210LymphoblastP1_532.pair\", header=T, nrows=390000, comment.char = \"\", colClasses=classes, skip=1)<br /> ",
    "4| mLymph1Cy5 &lt;- read.delim\\(\"318990_4L1210LymphoblastP1_635.pair\", header=T, nrows=390000, comment.char = \"\", colClasses=classes, skip=1)<br /> ",
    "5| mLymph1 &lt;- data.frame\\(S_Cy5=mLymph1Cy5\\[,10],S_Cy3=mLymph1Cy3\\[,10])<br /> ",
    "6| mLymph2 &lt;- data.frame\\(S_Cy5=mLymph2Cy5\\[,10],S_Cy3=mLymph2Cy3\\[,10])<br /> ",
    "7| write.table\\(mLymph1, file=\"318990_4L1210LymphoblastP1.rgl.txt\", row.names=F, quote=F, sep=\"\\t\", eol=\"\\r\\n\")<br /> ",
    "8| write.table\\(mLymph2, file=\"319048_4L1210LymphoblastP1-2.rgl.txt\", row.names=F, quote=F, sep=\"\\t\", eol=\"\\r\\n\")</p> ",
    " ",
    "<p><strong>2.)",
    "Create a \"targets\" text file that describes the target files for normalization.</strong>",
    "We will name this file \"T.txt\".  ",
    "Note that, to be read correctly, the file should be tab-delimited and contain only one carriage return at the end of the final line.  ",
    "Place this file in the same directory as the raw .pair files and .rgl files generated above.</p> ",
    " ",
    "<p>SlideNumber Name    FileName                              Cy3   Cy5<br /> ",
    "1           mLymph1 318990_4L1210LymphoblastP1.rgl.txt    late  early<br /> ",
    "2           mLymph2 319048_4L1210LymphoblastP1-2.rgl.txt  early late</p> ",
    " ",
    "<p><strong>3.)",
    "Install the LIMMA package.</strong>  Install a current version of the LIMMA package according to the instructions at <a href=\"http://bioinf.wehi.edu.au/limma/\">http://bioinf.wehi.edu.au/limma/</a> , or using the command line interface:</p> ",
    " ",
    "<p>9|  source\\(\"http://www.bioconductor.org/biocLite.R\")<br /> ",
    "10| biocLite\\(\"limma\")<br /> ",
    "11| biocLite\\(\"statmod\")</p> ",
    " ",
    "<p><strong>4.)",
    "Perform loess and scale normalization using LIMMA.</strong>  Loess normalization \\(normalizeWithinArrays) corrects the internal dependence of red-green ratios on their intensity independently for each array, and is examined further in sections QC#1 and QC#3.  ",
    "Scale normalization \\(normalizeBetweenArrays) equalizes the distribution of timing values between multiple samples for comparisons.</p> ",
    " ",
    "<p>12| library\\(limma)<br /> ",
    "13| setwd\\(\"D:\\\\RT",
    "project\\\\Raw datasets\")<br /> ",
    "14| t = readTargets\\(\"T.txt\", row.names=\"Name\")<br /> ",
    "15| r = read.maimages\\(t, source=\"generic\",columns=list\\(R=\"S_Cy5\", G=\"S_Cy3\"))<br /> ",
    "16| MA.l = normalizeWithinArrays\\(r, method=\"loess\")<br /> ",
    "17| MA.q = normalizeBetweenArrays\\(MA.l, method=\"scale\")</p> ",
    " ",
    " ",
    "<p><strong>QC # 1 \u2014  Distribution of spot intensities for red and green channels</strong></p> ",
    " ",
    "<p>",
    "The distributions of red and green spot intensities should be fairly well aligned , and have tails with high \\(above 211, or 2048) signal.  ",
    "Experiments in which signal intensity drops off more sharply will often show higher levels of noise in the final dataset \\(<strong>",
    "Fig.3A</strong>).<br",
    "/> ",
    " <br /> ",
    "18| plotDensities\\(r)<br /> ",
    "19| plotDensities\\(MA.l)<br /> ",
    "20| plotDensities\\(MA.q)</p> ",
    " ",
    "<p><strong>QC #2 \u2014 Distribution of ratio values before and after normalization</strong></p> ",
    " ",
    "<p>Boxplots of the Cy5/Cy3 ratios for each experiment may be slightly different before normalization \\(and after within-array normalization), but 1st and 3rd quartiles \\(the box boundaries) of all experiments should be equal after between-array normalization \\(<strong>",
    "Fig.3B</strong>).</p> ",
    " ",
    "<p>21| boxplot\\(MA.l$M~col\\(MA.l$M), names=colnames\\(MA.l$M))<br /> ",
    "22| boxplot\\(MA.q$M~col\\(MA.q$M), names=colnames\\(MA.q$M))</p> ",
    " ",
    "<p><strong>QC #3 \u2014 Ratio vs. intensity plots</strong></p> ",
    " ",
    "<p>Create MA plots to examine dependence of ratios on signal intensities.  ",
    "Points will often be skewed to low Cy5/Cy3 ratios at low intensities due to photobleaching of Cy5, but should be corrected after within-array loess normalization in LIMMA \\(<strong>Fig.3C</strong>).</p> ",
    " ",
    "<p>23| plotMA\\(r, array=1)     # Raw data, replicate 1<",
    "br /> ",
    "24| plotMA\\(MA.l, array=1)  # After within-array normalization</p> ",
    " ",
    "<p><strong>5.)",
    "Create an intermediate file containing the normalized datasets.</strong>  At this stage we can write a file containing the results of normalization and remove the other data from memory.</p> ",
    " ",
    "<p>25|",
    "write.table\\(MA.q$M, file=\"Loess_mLymph_112909.txt\", quote=F, row.names=F, sep=\"\\t\")<br /> ",
    "26| rm\\(r, MA.l, MA.q, mLymphCy3, mLymphCy5, mLymph1, mLymph2); gc\\(reset=T)</p> ",
    " ",
    "<p><strong>6.)",
    "Assign position and chromosome information to the normalized datasets.</strong>",
    "This can be accomplished using the original .pair files, which typically contain this information in columns \"POSITION\" and \"SEQ_ID\" respectively.</p> ",
    " ",
    "<p>27| tab5rows &lt;- read.table\\(\"Loess_mLymph_112909.txt\", header = TRUE, nrows = 5)<br /> ",
    "28| classes &lt;- sapply\\(tab5rows, class)<br /> ",
    "29| RT = read.table\\(\"Loess_mLymph_112909.txt\", header=T, nrows=390000, comment.char = \"\", colClasses=classes)<br /> ",
    "30| tab5rows &lt;- read.delim\\(\"318990_4L1210LymphoblastP1_635.pair\", header = T, nrows = 5, skip=1)<br /> ",
    "31| classes &lt;- sapply\\(tab5rows, class)<br /> ",
    "32| a = read.delim\\(\"318990_4L1210LymphoblastP1_635.pair\", header=T, nrows=390000, comment.char = \"\", colClasses=classes, skip=1)<br /> ",
    "33| RT$CHR = a$SEQ_ID<br /> ",
    "34| RT$POSITION",
    "= a$POSITION</p> ",
    " ",
    "<p>For datasets containing a different format of SEQ_ID column \\(e.g., \" chr11:1-134452384\", use the following lines to parse chromosome and probe position information from the PROBE_ID column:</p> ",
    " ",
    "<p>35| b = a$PROBE_ID <br /> ",
    "36| b = as.character\\(b)<br /> ",
    "37| x = strsplit\\(b, \"FS\")<br /> ",
    "38| y = unlist\\(x)       # chr \\[1:1439379] \"CHR10\" \"057882816\" \"CHR10\"<br /> ",
    "39| y1 = y\\[c\\(TRUE, FALSE)]",
    "# chr \\[1:719690] \"CHR10\" \"CHR10\" \"CHR10\"<br /> ",
    "40| y2 = y\\[c\\(FALSE,TRUE)]",
    "# chr \\[1:719689] \"057882816\" \"104954995\"<br /> ",
    "41| y2 = as.numeric\\(y2) # num \\[1:719690]",
    "5.79e+07 1.05e+08 7.31e+07<br /> ",
    "42| RTa= data.frame\\(CHR=y1,POSITION=y2, RT, stringsAsFactors=F)</p> ",
    " ",
    "<p><strong>7.)",
    "Plot timing values across a chromosome.</strong>  ",
    "This serves to verify the orientation for early/late domains, as well as the overall technical quality of the experiments \\(<strong>Fig.2A</strong>).</p> ",
    " ",
    "<p>43| RTb = subset\\(RT, RT$CHR==\"chr1\")<br /> ",
    "44| par\\(mar=c\\(3.1,4.1,1,1),mfrow=c\\(2,1))<br /> ",
    "45| plot\\(RTb\\[,4]~RTb$POSITION,pch=19,cex=0.2,col=\"grey\",ylim=c\\(-3,3))<br /> ",
    "46| plot\\(RTb\\[,5]~RTb$POSITION,pch=19,cex=0.2,col=\"grey\",ylim=c\\(-3,3))</p> ",
    " ",
    "<p>Using known regions of early or late replication, we can now verify that the timing values are properly oriented.  ",
    "If not, we reverse them by multiplying the appropriate data columns by -1.</p> ",
    " ",
    "<p>47| RT\\[,c\\(4,5)] = RT\\[,c\\(4,5)]",
    "* -1   #",
    "Reverses early/late orientation</p> ",
    " ",
    "<p><strong>8.)",
    "Average replicate datasets.</strong>",
    "This is quite straightforward:</p> ",
    " ",
    "<p>48| RT$mLymphAve = \\(RT\\[,4] + RT\\[,5]) /",
    "2</p> ",
    " ",
    "<p><strong>QC #4 \u2014 Autocorrelation function \\(ACF)</strong></p> ",
    " ",
    "<p>",
    "Since nearby loci should replicate almost synchronously, the correlation of timing between neighboring probes, or autocorrelation, is a useful measure of overall data quality.  ",
    "High-quality datasets will have a correlation between nearest neighbor timing values of R = 0.60-0.80.  ",
    "Before checking the autocorrelation, it is important to ensure that the data is sorted by chromosome and genomic position, as below:</p> ",
    " ",
    "<p>49| RT = RT\\[order\\(RT$CHR, RT$POSITION),]</p> ",
    " ",
    "<p>",
    "Next, plot the autocorrelation and output the second \\(nearest neighbor) autocorrelation to the console:</p> ",
    " ",
    "<p>50| acf\\(RT\\[,4],lag=1000)$acf \\[2]  # Replicate 1: R = 0.742<br /> ",
    "51| acf\\(RT\\[,5],lag=1000)$acf \\[2]  # Replicate 2: R = 0.665<br /> ",
    "52| acf\\(RT$mLymphAve, lag=1000)$acf \\[2] # Averaged 1 and 2: R = 0.762</p> ",
    " ",
    "<p><strong>QC #5 \u2014 Array image to check for spatial artifacts</strong></p> ",
    " ",
    "<p>Spatial artifacts in the scanned images should not much affect timing values in any particular location in the genome, but may reduce the overall signal to noise ratio of the experiment.",
    "To check for spatial artifacts, examine the original .tiff images for signs of regional bias.</p> ",
    " ",
    "<p><strong>Analysis of static properties of the timing program in a given cell type</strong></p> ",
    " ",
    "<p><strong>1.)",
    "Loess smoothing.</strong> Loess is a locally weighted smoothing method useful for deriving an overall replication profile from noisier raw data.",
    "The smoothness of the fitted line can be set by a bandwidth parameter, which we typically set to the equivalent of 300 kilobases for studies of human and mouse replication timing.  ",
    "Note that optimal smoothing span is system-specific and should be determined empirically by finding the smallest span that reproduces most of the features between replicate profiles.</p> ",
    " ",
    "<p>53| chrs = levels\\(RT$CHR);",
    "str\\(chrs)  # Create a list of all chromosomes<br /> ",
    "54| chrs = chrs\\[-22]    ",
    "# Remove chrY_random<",
    "br /> ",
    "55|",
    "AllLoess = NULL<br /> ",
    "56| for \\(chr in chrs)  \\{   #",
    "For each chromosome,<br /> ",
    "57| RTl = NULL    # Create a variable to store loess-smoothed values<br /> ",
    "58| RTb = subset\\(RT, RT$CHR==chr)",
    "# Subset the dataset to a single chromosome<br /> ",
    "59| lspan = 300000/\\(max\\(RTb$POSITION)-min\\(RTb$POSITION))",
    "# Set smoothing span<br /> ",
    "60| cat\\(\"Current chromosome: \", chr, \"\\n\")",
    "# Output current chromosome/dataset<br /> ",
    "61|",
    "RTla = loess\\(RTb$X318990_4L1210LymphoblastP1.rgl ~ RTb$POSITION, span = lspan)<br /> ",
    "62| RTlb = loess\\(RTb$X319048_4L1210LymphoblastP1.2.rgl ~ RTb$POSITION, span = lspan)<br /> ",
    "63| RTlc = loess\\(RTb$mLymphAve ~ RTb$POSITION, span = lspan)<br /> ",
    "64| RTl = data.frame\\(CHR=RTb$CHR, POSITION=RTb$POSITION, RTla$fitted, RTlb$fitted, RTlc$fitted)<br /> ",
    "65| AllLoess = rbind\\(AllLoess, RTl)<br /> ",
    "66| }<br /> ",
    "67| x = as.data.frame\\(AllLoess)<br /> ",
    "68| names\\(x)\\[4:5] = c\\(\"x300smo_4L1210LymphoblastR1\", \"x300smo_4L1210LymphoblastR2\")</p> ",
    " ",
    "<p>",
    "We can now check the results of loess smoothing using the following \\(<strong>Fig.",
    "2B</strong>):</p> ",
    " ",
    "<p>69| RTc = subset\\(RT, CHR==\"chr1\")<br /> ",
    "70| LSc = subset\\(LS, CHR==\"chr1\")<br /> ",
    "71| par\\(mar=c\\(2.2,5.1,1,1),mfrow=c\\(3,1), col=\"grey\", pch=19, cex=0.5, cex.lab=1.8, xaxs=\"i\")<br /> ",
    "72| plot\\(RTc$X318990_4L1210LymphoblastP1.rgl~RTc$POSITION, ylab=\"mLymph R1\", xaxt=\"n\")<br /> ",
    "73| lines\\(LSc$x300smo_4L1210LymphoblastR1~LSc$POSITION, col=\"blue3\", lwd=3)<br /> ",
    "74| plot\\(RTc$X319048_4L1210LymphoblastP1.2.rgl~RTc$POSITION, ylab=\"mLymph R2\", xaxt=\"n\")<br /> ",
    "75| lines\\(LSc$x300smo_4L1210LymphoblastR2~LSc$POSITION, col=\"blue3\", lwd=3)",
    "<br /> ",
    "76| plot\\(RTc$mLymphAve~RTc$POSITION, xlab=\"Coordinate \\(bp)\", ylab=\"mLymph ave\")",
    "<br /> ",
    "77| lines\\(LSc$x300smo_4L1210LymphoblastAve~LSc$POSITION, col=\"blue3\", lwd=3)</p> ",
    " ",
    "<p><strong>QC #6 \u2014 Correlations between replicate experiments</strong></p> ",
    " ",
    "<p>Once loess smoothing is completed and the technical quality of the array data is established, we can compare biological replicate experiments to establish the relative level of biological similarity between samples.  ",
    "To isolate biological rather than array quality differences, we typically use loess-smoothed averaged-replicate data, rather than individual, raw or normalized data, for these correlations:</p> ",
    " ",
    "<p>78| cor\\(x\\[,c\\(4:6)]<br /> ",
    " <br /> ",
    "     Rep1  Rep2  Ave<br /> ",
    " ",
    "Lymphoblast Rep1  1.000  0.978  0.995<br /> ",
    " Lymphoblast Rep2              0.978  1.000  0.994<br /> ",
    " Lymphoblast Ave             0.995  0.994  ",
    "1.000</p> ",
    " ",
    "<p><strong>2.)",
    "Segmentation.</strong>",
    "Segmentation is a useful way to define the boundaries of replication domains and determine their average timing.  ",
    "Biologically, these segments appear to correspond to domains of coordinately regulated, synchronously firing origins that may be part of replication factories.  ",
    "We perform segmentation using the DNACopy algorithm designed by Venkatraman et al.<sup>17 </sup>.</p> ",
    " ",
    "<p>79| library\\(DNAcopy)<br /> ",
    "80| mLymph = CNA\\(RT$mLymphAve, RT$CHR, RT$POSITION, data.type=\"logratio\", sampleid = \"mLymph\")<br /> ",
    "81|",
    "Seg.mLymph = segment\\(mLymph, nperm=10000, alpha=1e-15, undo.splits=\"sdundo\", undo.",
    "SD=1.5, verbose=2)<br /> ",
    "82| write.table\\(Seg.mLymph$output, row.names=F, quote=F, file=\"Mouse lymphoblast segments.txt\", sep=\"\\t\")</p> ",
    " ",
    "<p>The number of segments assigned can be examined using str\\(Seg.mLymph$output), and visualized using various functions built into DNAcopy \\(<strong>Fig.",
    "2C</strong>).</p> ",
    " ",
    "<p>83| par\\(ask=T,mar=c\\(3.1,4.1,1,1))   # Set figure margins<br /> ",
    "84| plot\\(Seg.mLymph, plot.type=\"c\") # Plot each chromosome separately<br /> ",
    "85| plot\\(Seg.mLymph, plot.type=\"s\") # Plot overview of all chromosomes<br /> ",
    "86| plot\\(subset\\(Seg.mLymph,chromlist=\"chr2\"), pch=19, pt.cols=c\\(\"gray\",\"gray\"), xmaploc=T, ylim=c\\(-3,3), main=\"\")</p> ",
    " ",
    "<p>Datasets with different technical quality should be adjusted to the same autocorrelation level before segmentation to avoid assigning additional domains to higher-quality datasets.",
    "For this purpose, we adapt the \"jitter\" function of Chambers et al.<sup>18</sup>, substituting Gaussian noise for uniformly distributed noise.</p> ",
    " ",
    "<p>88|addNoise = function\\(x, factor = 1, amount = NULL)  \\{<br /> ",
    "89|     if \\(length\\(x)==0)       ",
    "<br /> ",
    "90|        return\\(x)<br /> ",
    "91|     if \\(\\!is.numeric\\(x))<br /> ",
    "92|         stop\\(\"'x' must be numeric\")<br /> ",
    "93|     z &lt;- diff\\(r &lt;- range\\(x\\[is.finite\\(x)]))<br /> ",
    "94|     if \\(z==0)<br /> ",
    "95|         z &lt;- abs\\(r \\[1] )",
    "<br /> ",
    "96|     if \\(z==0)<br /> ",
    "97|         z &lt;- 1<br /> ",
    "98|     if \\(is.null\\(amount))",
    "\\{<br /> ",
    "99|        d &lt;- diff\\(xx &lt;- unique\\(sort.int\\(round\\(x, 3 -   <br /> ",
    "100|  floor\\(log10\\(z))))))<br /> ",
    "101|        ",
    "d &lt;- if \\(length\\(d))<br /> ",
    "102|            min\\(d)<br /> ",
    "103|        else if \\(xx \\!= 0)<br /> ",
    "104|            ",
    "xx/10<br /> ",
    "105|        else z/10<br /> ",
    "106|         amount &lt;- factor/5 *",
    "abs\\(d)<br /> ",
    "107| }<br /> ",
    "108|    else if \\(amount==0)<br /> ",
    "109|         amount &lt;- factor * \\(z/50)<br /> ",
    "110|    x + stats::rnorm\\(length\\(x), 0, amount)<br /> ",
    "111| }<br /> ",
    "112| RT$mLymphR1noise = addNoise\\(as.numeric\\(RT$mLymphR1), factor=300, amount=.848)<br /> ",
    "113| RT$mLymphR2noise = addNoise\\(as.numeric\\(RT$mLymphR2), factor=300, amount=.968)<br /> ",
    "114| acf\\(RT$mLymphR1noise)$acf \\[2] #0.8274651<br /> ",
    "115| acf\\(RT$mLymphR2noise)$acf \\[2] #0.8274654</p> ",
    " ",
    "<p><strong>3.)",
    "Domain size analysis \\(boxplots of sizes).</strong>",
    "After segmentation, the sizes of replication domains can be extracted from the segmented dataset to examine average sizes examined together or separately for domains with early or late timing.<br /",
    "> ",
    "116| LymphR1 = Seg.mLymphR1$output; LymphR2 = Seg.mLymphR2$output<br /> ",
    "117| LymphR1$size",
    "= LymphR1$loc.end - LymphR1$loc.start<br /> ",
    "118| LymphR2$size = LymphR2$loc.end - LymphR2 $loc.start<br /> ",
    "119|",
    "LymphR1Early = subset\\(LymphR1, LymphR1$seg.mean &gt; 0)<br /> ",
    "120|",
    "LymphR2Late",
    "= subset\\(LymphR2, LymphR2$seg.mean &lt; 0)<br /> ",
    "121| boxplot\\(LymphR1Early$size, LymphR2Early$size, LymphR1Late$size, LymphR2Late$size)</p> ",
    " ",
    "<p><strong>Analysis of dynamic changes in the timing program</strong></p> ",
    " ",
    "<p>To examine changes in the replication program during differentiation, several useful methods leverage the segmentation and loess smoothing methods introduced above.  ",
    "Since no single method is sufficient to fully describe the type, degree, and distribution of timing changes during development, we cover several complementary ways to measure these properties and explore the relationships between cell types.</p> ",
    " ",
    "<p><strong>4.)",
    "Percent changes analysis.</strong> To quantify the amount of the genome changing timing between two or more cell types, we  recommend applying an empirical cutoff for biologically measurable timing changes to quantify these genome-wide.",
    "As most methods for quantifying timing changes are sensitive to scale differences, datasets should be scaled and normalized together in LIMMA prior to analysis.</p> ",
    " ",
    "<p>122| RTd1",
    "= RT$mLymphR1 - RT$mLymphR2",
    "<br /> ",
    "123| mLength = length\\(RTd1)   # Total number of probes<br /> ",
    "124| s = 0.67 # Cutoff for significant changes   <br /> ",
    "125| sum\\(abs\\(RTd1)&gt;s)/mLength # Percentage changing, R1 vs. R2<br /> ",
    "126| sum\\(RTd1 &lt;",
    "-s)/mLength   # EtoL subset: 1.6%<br /> ",
    "127| sum\\(RTd1 &gt;",
    "s)/mLength    # LtoE subset: 1.3%</p> ",
    " ",
    "<p><strong>5.)",
    "Clustering approaches.</strong>",
    "Our two most common methods are hierarchical clustering, which agglomerates experiments from the most similar pairs of replication profiles to gradually more inclusive clusters, and k-means clustering, which partitions a set of timing profiles into a pre-set <em>k</em> number of similar patterns.  ",
    "For k-means clustering, we useCluster<sup>19</sup>  and TreeView \\( <a href=\"http://rana.lbl.gov/EisenSoftware.htm\">http://rana.lbl.gov/EisenSoftware.htm</a>).  ",
    "For hierarchical clustering, we use the \"pvclust\" package in R<sup>20</sup>, Since many clustering algorithms are computationally intensive, and to improve the precision of individual RT measurements, we average timing datasets into 200kb windows prior to clustering:</p> ",
    " ",
    "<p>128| mLymph.",
    "R1 = NULL; mLymph.",
    "R2 = NULL<br /> ",
    "129| for \\(x in 1:10994) \\{ <br /> ",
    "130|   z1 = x * 35  # For 385k arrays,<br /> ",
    "131|   z2 = \\(x+1) *",
    "* 35  # 5.8kb median spacing ** 35 = 203kb<br /> ",
    "132|   mLymph.",
    "R1\\[x] = mean\\(RT$mLymphR1\\[z1:z2])<br /> ",
    "133|   mLymph.",
    "R2\\[x]= mean\\(RT$mLymphR2\\[z1:z2])<br /> ",
    "134|   cat\\(\"Current window: \", x, \"\\n\")<br /> ",
    "135| }<br /> ",
    "136| RT = data.frame\\(mLymph.",
    "R1, mLymph.",
    "R2)<br /> ",
    "137| library\\(pvclust)<br /> ",
    "138| cluster.bootstrap &lt;- pvclust\\(RT, nboot=1000, method.dist=\"abscor\")<br /> ",
    "139| plot\\(cluster.bootstrap)<br /> ",
    "140|",
    "pvrect\\(cluster.bootstrap)</p> ",
    " ",
    "<p><strong>6.)",
    "Properties of RT switching domains.</strong> To compute domains that switch to earlier or later replication timing during development, we first subtract the normalized \\(not loess smoothed) values of the two experiments to be compared, then segment the resulting profile of timing changes as shown below:</p> ",
    " ",
    "<p>141| dRT = CNA\\(RT$NPCave-RT$ESCave, RT$CHR, RT$POSITION, data.type=\"logratio\", sampleid=  \"NPC-ESC dRT\")<br /> ",
    "142| Seg.dRT",
    "= segment\\(dRT, nperm=10000, alpha=1e-15, undo.splits = \"sdundo\", undo.",
    "SD=1.5, verbose=2)<br /> ",
    "143|",
    "dRTdom = Seg.dRT$output<br /> ",
    "144| quantile\\(dRTdom$seg.mean, probs = c\\(0.05, 0.95))",
    "# Top 5%<br /> ",
    "145| quantile\\(dRTdom$seg.mean, probs = c\\(0.40, 0.60))",
    "# Middle 20%<br /> ",
    "146| LtoEdom = subset\\(dRTdom, dRTdom$seg.mean &gt; 1.28552) <br /> ",
    "147| EtoLdom = subset\\(dRTdom, dRTdom$seg.mean &lt; -1.32328)<br /> ",
    "148| middleDom",
    "= subset\\(dRTdom, dRTdom$seg.mean &gt; -0.14808 &amp;  dRTdom$seg.mean &lt; 0.23698)</p> ",
    " ",
    "<p><strong>7.)",
    "Assignment of replication timing values to gene promoters.</strong>",
    "The smoothed data object produced by loess is valuable for calculating timing \\(or other) values at a shared set of genomic coordinates, which is especially helpful for comparing datasets from different array platforms or assigning timing data to NCBI's RefSeq gene promoter locations \\( <a href=\"http://www.ncbi.nlm.nih.gov/RefSeq/\">http://www.ncbi.nlm.nih.gov/RefSeq/</a>) as outlined below:</p> ",
    " ",
    "<p>149| chrs = levels\\(RefSeq$CHR) # List of chromosomes to be analyzed<br /> ",
    "150| AllSm = NULL  # Store smoothed data for all chromosomes<br /> ",
    "151| ChrSm = NULL # Store smoothed data for current chromosome<br /> ",
    "152| for\\(chr in chrs) \\{<br /> ",
    "153| RTc = subset\\(RT, CHR==chr)<br /> ",
    "154| RSc = subset\\(RefSeq, CHR==chr)<br /> ",
    "155| cat\\(\"Current chromosome: \", chr, \"\\n\")<br /> ",
    "156| lspan = 300000/\\(max\\(RTc$POSITION)-min\\(RTc$POSITION))",
    "<br /> ",
    "157|  <br /> ",
    "158| smLym1    = loess\\(RT$mLymphR1 ~",
    "RT$POSITION, span = lspan)<br /> ",
    "159| smLym2    = loess\\(RT$mLymphR2  ~",
    "RT$POSITION, span = lspan)",
    "<br /> ",
    "160| smLym3    = loess\\(RT$mLymphAve  ~ RT$POSITION, span = lspan)<br /> ",
    "161|",
    "<br /> ",
    "162| Lym1    = predict\\(smLym1, RSc$TSS)",
    "<br /> ",
    "163| Lym2    = predict\\(smLym2, RSc$TSS)<br /> ",
    "164| Lym3    = predict\\(smLym3, RSc$TSS)<br /> ",
    "165| <br /> ",
    "166|",
    "ChrSm = data.frame\\(CHR=chr,POSITION= RSc$TSS, Lym1, Lym2, Lym3)<br /> ",
    "167|",
    "AllSm = rbind\\(AllSm, ChrSm)<br /> ",
    "168| }<br /> ",
    "169| write.table\\(AllSm, \u201cMouse lymphoblast RT at RefSeq gene positions.txt\u201d, quote=F, sep=\u201d\\t\u201d)</p> ",
    " ",
    "<p><strong>8.)",
    "Assignment of histone and other epigenetic marks to gene promoters.</strong>",
    "Through the ENCODE project and other initiatives, a wide array of epigenetic datasets have been made, and similar data repositories.",
    "Just as timing can be assigned to gene promoters as outlined above, datasets from GEO \\( <a href=\"http://www.ncbi.nlm.nih.gov/geo/\">http://www.ncbi.nlm.nih.gov/geo/</a>) or the UCSC Genome Browser \\( <a href=\"http://genome.ucsc.edu/\">http://genome.ucsc.edu/</a>) can be assigned to any set of genomic loci, including gene promoters or the boundaries of replication domains.  ",
    "Below is a generic method for assigning values from epigenetic mark datasets to promoter regions surrounding gene transcription start sites.  ",
    "However, note that the specific methods of quantification should be informed by the biological properties of the marks to be quantified and the questions to be addressed.</p> ",
    " ",
    "<p>170| chrs = levels\\(Marks$CHR);  AllGenes = NULL;  ",
    "AllHist = NULL<br /> ",
    "171| for \\(chr in chrs) \\{<br /> ",
    "172| RSc = subset\\(RefSeq, CHR==chr)    ",
    "<br /> ",
    "173| RTc = subset\\(Marks, CHR==chr)<br /> ",
    "174| for\\(m in 1:nrow\\(RSc))",
    "\\{<br /> ",
    "175|  if\\(RSc\\[m,]$Strand==\"+\")  \\{<br /> ",
    "176| RTcSub =",
    "subset\\(RTc, \\(RTc$Start &lt; RSc\\[m,]$txStart +500) &amp; \\(RTc$Start &gt; RSc\\[m,]$txStart - 2500))<br /> ",
    "177|   AllHist = rbind\\(AllHist, apply\\(RTcSub, 2, max)\\[3:12])<br /> ",
    "178|   AllGenes = rbind\\(AllGenes, RSc\\[m,]$Gene)<br /> ",
    "179|  }<br /> ",
    "180|  if\\(RSc\\[m,]$Strand==\"-\")  \\{<br /> ",
    "181| RTcSub = subset\\(RTc, \\(RTc$Start &lt; RSc\\[m,]$txEnd +2500) &amp;",
    "\\(RTc$Start &gt; RSc\\[m,]$txEnd - 500))<br /> ",
    "182|   AllHist = rbind\\(AllHist, apply\\(RTcSub, 2, max)\\[3:12])<br /> ",
    "183|   AllGenes = rbind\\(AllGenes, RSc\\[m,]$Gene)<br /> ",
    "184|<br /> ",
    "185|       }<br /> ",
    "186|   cat\\(\"Chromosome:\", chr, \"   Gene:\", m, \"/\", nrow\\(RSc), \"\\n\")<br /> ",
    "187|   }<br /> ",
    "188|",
    "}",
    "<br /> ",
    "189|",
    "OutFile = data.frame\\(cbind\\(AllGenes, AllHist), stringsAsFactors=F)<br /> ",
    "190| write.table\\(OutFile, file=\"Histone modifications at RefSeq gene<br /> ",
    "positions.txt\", row.names=F, quote=F, sep=\"\\t\")</p> ",
    " ",
    " ",
    "<p><strong>9.)",
    "Integration of epigenetic mark values over replication domains \\(density vs. timing)</strong>",
    "Given that the magnitude of correlations between genetic properties generally increases when measured in larger windows, it is important to quantify these relationships in windows consistent with biologically regulated unit sizes.  ",
    "The method below can be used to compute correlations between domainwide replication timing values and the average level of epigenetic marks within timing domains segmented above.</p> ",
    " ",
    "<p>191| Seg.",
    "RT = read.table\\(\"Lymph-1 segments.txt\",header=T)<br /> ",
    "192| chrs = levels\\(Seg.RT$chrom)<br /> ",
    "193| MarksData = NULL # Store averaged mark data in domains<br /> ",
    "194|",
    "RTData = NULL  <br /> ",
    "195| dom = 0    ",
    "<br /> ",
    "196| for\\(chr in chrs) \\{<br /> ",
    "197|",
    "Seg.RTb = subset\\(Seg.",
    "RT, Seg.RT$chrom==chr)<br /> ",
    "198| MarksB",
    "= subset\\(Marks, Marks$CHR==chr)<br /> ",
    "199| for \\(i in 1:dim\\(Seg.",
    "RTb) \\[1] ) \\{<br /> ",
    "200|  # Find subset of marks in RT domain<br /> ",
    "201|  cat\\(\"Current chr:\", chr, \"  Domain:\", i, \"\\n\")",
    "<br /> ",
    "202|",
    "MarksD = subset\\(MarksB, MarksB$Start &gt; Seg.RTb\\[i,]$loc.start &amp; MarksB$Start &lt; Seg.RTb\\[i,]$loc.end)<br /> ",
    "203|   ",
    "MarksD = MarksD\\[,3:12]<br /> ",
    "204|   MarksD\\[,1:10] = MarksD\\[,1:10] - MarksD\\[,1]<br /> ",
    "205|  ",
    "MarksData = rbind\\(MarksData, apply\\(MarksD,2, \"mean\"))<br /> ",
    "206|   dom = dom + 1<br /> ",
    "207|       }<br /> ",
    "208| }<br /> ",
    "209| cor\\(Seg.",
    "RT$seg.mean, data.frame\\(MarksData))<br /> ",
    "210| plot\\(Seg.",
    "RT$seg.mean, data.frame\\(MarksData) \\[1] )",
    "</p>"
]