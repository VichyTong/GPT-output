[
    "<p><strong>Before you begin</strong>&nbsp;</p><p>",
    "This protocol is written for researchers with a working understanding of immunohistochemical (IHC) labeling approaches and fluorescence microscopy.",
    "Before implementing this protocol, users should optimize labeling specificity and signal-to-noise ratios for the immunohistochemical assay.",
    "Furthermore, this protocol requires technical skills in histology and ultrasectioning.",
    "Additionally, users should familiarize themselves with principles of single-molecule localization microscopy (SMLM) and operation of available commercial instrumentation.&nbsp;</p><p><br></p><p><strong>Prepare fluorescent dye conjugates for IHC&nbsp;(Timing: 2h)</strong></p><p>The following steps describe the amine-reactive conjugation of fluorescent dyes to secondary antibodies and wheat germ agglutinin (WGA).",
    "The conjugates are used in this protocol to label&nbsp;primary antibodies in indirect IHC and endogenous glycoproteins in neuropil, respectively.",
    "Some dyes are reagents section (see also Dempsey et al., 2011;",
    "Li &amp; Vaughan, 2018).",
    "Additional considerations when selecting dyes for multicolor imaging can be found in Figure 10.&nbsp;</p><p><br></p><p>1.",
    "Prepare fresh 1M NaHCO3 and keep solution ice cold.",
    "Mix 80 \u03bcl of secondary antibody (stock concentration 1 mg/mL) or WGA with 10 \u03bcl 1M NaHCO3.&nbsp;</p><p>2.",
    "Add 1.8 \u03bcl reporter dye and 1.2 \u03bcl activator dye to the solution.&nbsp;</p><p><strong>Note: </strong>Dual labeled antibodies are used to increase reporter dye photoswitching (Dy 749/Alexa 647) through UV illumination of the activator dye (Alexa 405).",
    "Cy3B and Atto 488 reporter photoswitching is not increased in the presence of activator dyes therefore",
    "no Alexa 405 is added to those conjugation reactions.&nbsp;</p><p>3.",
    "Vortex the solution briefly.&nbsp;</p><p>4.",
    "Incubate the solution at room temperature for 20 min with constant agitation and protect from light.",
    "Meanwhile, allow a NAP-5 column to drain its storage buffer into a waste receptacle.",
    "Fill the empty NAP-5 column with 1x PBS and allow the waste to drain.",
    "Repeat washing two more times.&nbsp;</p><p><strong>Critical: </strong>Rinse the NAP-5 column at least three times (Troubleshooting 1).&nbsp;</p><p>5.",
    "Pipette the conjugate solution onto the surface of the NAP-5 column and allow solution to sink into the column surface for ~30 seconds.&nbsp;</p><p>6.",
    "Add 600 \u03bcl 1x PBS to the column.",
    "Allow the clear PBS fraction to drain from the column into a waste receptacle.&nbsp;</p><p><strong>Note: </strong>Free dyes will separate from conjugates creating two bands that may be visible depending on fluorophore wavelength (Cy3B is especially visible, 488 and 647 are somewhat visible and 749 is very difficult to see).&nbsp;</p><p>7.",
    "Add 300 \u03bcl 1x PBS and collect the flowthrough into the final storage tube.",
    "Discard the column.&nbsp;</p><p>8.",
    "Measure conjugate concentration and dye ratios per antibody/WGA molecule:</p><p",
    ">a. Blank the spectrophotometer using the same 1x PBS as above.&nbsp;</p><p",
    ">b. Measure the absorbance profile of the conjugate and record the peak absorbance values of the antibody (~280 nm) and the dye molecules (~405-750 nm depending on dyes used).",
    "Save absorbance profile for future reference.&nbsp;</p><p>c. Using the concentration values, determine the number of dye molecules per antibody molecule.",
    "A calculator used to determine the molecular ratios is provided in an Excel spreadsheet along with this manual.&nbsp;</p><p><strong>Note</strong>:",
    "Ideally, each labeling protein molecule (IgG, IgY or WGA) will be conjugated to 3-4 reporter dye molecules and 1-2 activator dye molecules.",
    "If no activator is used, 3-4 reporter dye molecules should still be conjugated.&nbsp;</p><p><strong>Critical</strong>:",
    "If ratios are not ideal, repeat the procedure and adjust dye volumes added to solution in step 2 to achieve molecular ratios within the appropriate bounds.",
    "If more than 4 \u03bcl of dye is needed in step 2 in order to achieve correct ratios, then dye stocks may need to be remade (Troubleshooting 1).&nbsp;</p><p>d. Recollect conjugate from cuvette and store in the dark at 4\u00b0C for up to 6 months.&nbsp;</p><p>e. To confirm conjugate quality&nbsp;after a period of storage, remeasure and compare absorbance values to originals.&nbsp;</p><p><br></p><p><strong>Coat glass coverslips&nbsp;(Timing: 2h)</strong></p><p>The following steps are used to coat glass coverslips with gelatin, which will cause ultrathin sections to adhere when they are collected after ultrasectioning (Micheva &amp; Smith, 2007).",
    "While performing all steps, avoid allowing dust to collect onto the surface of the coverslips.",
    "Work in an area free from heavy airflow and filter all solutions.&nbsp;</p><p><br></p><p>1.",
    "Prepare 1M KOH and 95% EtOH.",
    "Separate coverslips in a rack, completely submerge into 1M KOH solution and sonicate with heat for 15 min.&nbsp;</p><p>2.",
    "Prepare gelatin solution.",
    "Heat to dissolve particulates, then filter the solution.&nbsp;</p><p>3.",
    "Rinse coverslips in filtered H2O, completely submerge them in 95% EtOH and sonicate with heat for 15 min.&nbsp;</p><p>4.",
    "Remove coverslip racks from 95% EtOH and allow them to air dry.",
    "Wick away excess ethanol.&nbsp;</p><p><strong>Alternative</strong>:",
    "Place racks in a 50\u00b0C oven until dry.&nbsp;</p><p><strong>Critical</strong>:",
    "Examine coverslips at this stage to check for clarity.",
    "If coverslips remain smudged or dusty, refilter 1M KOH and 95% EtOH, then start procedure again.&nbsp;</p><p>5.",
    "Completely submerge clean, dry coverslips in gelatin solution and swirl for 1 min.&nbsp;</p><p>6.",
    "Remove coverslip racks from gelatin solution and allow to air dry completely.",
    "Wick away excess solution from troughs of the coverslip rack.&nbsp;</p><p><strong>Note: </strong>Moving coverslips to a clean, dry rack can help eliminate gelatin pooling at the lower edges of the coverslips.&nbsp;</p><p>7.",
    "Allow coverslips to dry completely before use or storage.",
    "Store dry coverslips in a closed container.",
    "Coverslips should be kept free from dust.&nbsp;</p><p><br></p><p><strong>Collect and fix the tissue sample&nbsp;(Timing: 4-5h)</strong></p><p>During the following steps, tissue will be dissected and prepared for IHC.",
    "Importantly, the region of interest is punched out creating a small disk of tissue which is easy to maneuver while minimizing mechanical damage.",
    "The small disk improves antibody penetration and allows the tissue to lay flat for embedding.",
    "Fixative solution and blocking buffer should be prepared before you begin.&nbsp;</p><p><br></p><p>1.",
    "Euthanize mouse, enucleate eyes, and dissect retinae in room temperature 1x PBS.&nbsp;</p><p><strong>Note: </strong",
    ">These steps describe processing retinal tissue, but brain sections can also be used.&nbsp;</p><p>2.",
    "Fix tissue in room temperature 4% PFA for 10 min to 1 h.",
    "The fixation conditions should be adjusted to optimize IHC labeling quality.&nbsp;</p><p>3.",
    "Wash retinae in 1x PBS for 2x 20 min, then place it in a clean petri dish filled with room temperature 1x PBS.&nbsp;</p><p>4.",
    "Punch out a 500 \u03bcm diameter region of interest using a 25G blunt ended needle under stereoscope guidance.&nbsp;</p><p>5.",
    "Transfer punch to a 24-well plate and incubate in blocking buffer for 3-4 hours at room temperature with constant agitation.",
    "Continue on to IHC.&nbsp;</p><p><br></p><p><strong>Immunohistochemistry&nbsp;(Timing: 4-5 days)</strong></p><p>The following steps are performed to label antigen targets with primary and secondary antibodies.",
    "Target-specific staining is followed by a global neuropil stain using a WGA conjugate, which functions as an image alignment tool in later STORM data processing steps.",
    "Lastly, an aldehyde fixation establishes crosslinking to stabilize all molecular labels.&nbsp;</p><p>6.",
    "Prepare primary antibody solution by diluting 1 mg/mL antibody stocks to 1:100 in blocking buffer.",
    "Primary antibody dilution can be adjusted based on empirical testing.",
    "Transfer tissue punches to a new well containing primary antibody solution and incubate for 48-72 h at 4\u00b0C with constant agitation.&nbsp;</p><p>7.",
    "Transfer tissue to a new well containing wash buffer and incubate at room temperature for 6x 20 min with constant agitation.&nbsp;</p><p>8.",
    "Prepare secondary antibody solution by diluting secondary antibody conjugate stocks to 1:100 in blocking buffer.",
    "Secondary antibody dilution can be adjusted based on empirical testing.",
    "Secondary antibodies should be custom conjugated to photoswitchable dyes compatible with STORM imaging ahead of this step (see section: Prepare fluorescent dye conjugates for IHC).",
    "Transfer tissue punches to a new well containing secondary antibody solution and incubate for 24 h at 4\u00b0C with constant agitation.",
    "Protect samples from light.&nbsp;</p><p>9.",
    "Transfer tissue to a new well containing wash buffer and incubate at room temperature for 6x 20 min with constant agitation.",
    "Protect samples from light.&nbsp;</p><p>10.",
    "Prepare wheat germ agglutinin (WGA) solution by diluting WGA conjugate stock 1:10 in 1x PBS.",
    "WGA should be custom conjugated to photoswitchable dyes compatible with STORM imaging ahead of this step (see section: Prepare fluorescent dye conjugates for IHC).",
    "Transfer tissue to a new well containing WGA solution and incubate at room temperature for 12-16 h (overnight) with constant agitation.",
    "Protect samples from light.&nbsp;</p><p>11.",
    "Transfer tissue to a new well containing 1x PBS and incubate at room temperature for 2x 20 min with constant agitation.",
    "Protect samples from light.&nbsp;</p><p><strong>Critical: </strong>Tissue punches may stick to the inside of the pipette tip here.",
    "To avoid this, coat the inside of the pipette tip with blocking solution first, then transfer the tissue punches.&nbsp;</p><p>12.",
    "Transfer tissue to a new well containing post-fixation solution (3% PFA, 0.1% GA) and incubate for 2 h with constant agitation.",
    "Protect samples from light.&nbsp;</p><p>13.",
    "Transfer tissue to a new well containing 1x PBS and incubate at room temperature for 2x 20 min with constant agitation.",
    "Protect samples from light.",
    "Continue on to dehydration.&nbsp;</p><p><br></p><p><strong>Dehydrate and embed samples in resin&nbsp;(Timing: 1-2 days)</strong></p><p>The following steps plasticize the tissue punches to make them suitable for ultrasectioning.&nbsp;</p><p><br></p><p>14.",
    "Perform a graded alcohol dehydration:</p><p>a. Transfer tissue into a clean Eppendorf tube and immerse in a 50% EtOH solution.",
    "Incubate at room temperature for 20 min with constant agitation and protect sample from light.&nbsp;</p><p>b. Repeat with 70%, 90%, 100% and 100% EtOH.&nbsp;</p><p><strong>Critical: </strong>If tissue is not thoroughly dehydrated, the resin will not polymerize properly and crack or flake when taken out of the mold (Troubleshooting 2).&nbsp;</p><p>15.",
    "Perform a graded resin infusion:</p><p>a. Transfer tissue into a clean Eppendorf tube and immerse in a solution containing 2 parts 100% EtOH to 1 part resin.",
    "Incubate at room temperature for 2 h with constant agitation and protect sample from light.&nbsp;</p><p>b. Repeat with 1:1 EtOH:resin, 1:2 EtOH:resin, 100% resin and 100% resin.&nbsp;</p><p><strong>Pause Point</strong>: If needed, tissue punches can be left in 1:2 EtOH:resin or 100% resin overnight.&nbsp;</p><p>16.",
    "Transfer individual tissue punches into lids of embedding (Beem) capsules and gently center them under stereoscope guidance.",
    "Fit capsule body onto the lid and fill with 100% resin.",
    "Incubate samples at 70\u00b0C for 16h.&nbsp;</p><p><strong>Pause Point: </strong>Polymerized tissue punches have long-term stability.",
    "Store them in their molds in a dark, dry place and protect them from dust.&nbsp;</p><p><br></p><p><strong>Ultrasectioning&nbsp;(Timing: 1 day)</strong></p><p>The following steps describe the ultrasectioning and collection of serial ultrasections onto glass coverslips.",
    "For further technical troubleshooting and tips, see publications on array tomography and serial sectioning for electron microscopy (Micheva, et al., 2007; Harris, et al., 2006).&nbsp;</p><p><br></p><p>1.",
    "Trim and cut resin to produce 70 nm-thick serial section ribbons.",
    "Expand sections using chloroform vapor.&nbsp;</p><p>2.",
    "Secure gelatin coated coverslip in plastic forceps and guide it into the histo Jumbo diamond knife water bath (as pictured in Figure 6).&nbsp;</p><p>3.",
    "Using an eyelash tool, guide sections onto the middle of the coverslip and slowly retract the coverslip from the water bath by turning the knob on the micromanipulator.&nbsp;</p><p><strong>Caution</strong>: Leave sufficient space in the margins of the coverslip to accommodate the imaging objective.&nbsp;</p><p>4.",
    "Warm coverslips with sections facing upward on a hot plate set to 60\u00b0C for 20 min.&nbsp;</p><p><strong>Pause Point</strong>: Coverslips can be stored long-term prior to imaging.&nbsp;</p><p><br></p><p><strong>Etch away resin and assemble flow chamber&nbsp;(Timing: 30 min)</strong></p><p>The following steps prepare tissue sections for optimal photoswitching during STORM imaging.",
    "Here, the resin surrounding individual sections is removed allowing fluorophore exposure to the thiol-containing STORM imaging buffer.",
    "Fluorescent beads are spotted on the coverslips which will serve later as fiducial markers.",
    "The flow chamber is assembled, filled with STORM imaging buffer, and sealed with epoxy.",
    "Prepare 10 % sodium ethoxide before you begin; sodium ethoxide solution can be reused for multiple experiments but should be remade after 1 month.&nbsp;</p><p><br></p><p>1.",
    "Immerse the coverslip in 10% sodium ethoxide for 5 min.&nbsp;</p><p><strong>Critical</strong>:",
    "Following step 1, samples will be difficult to see.",
    "Note sample orientation on the coverslip.&nbsp;</p><p>2.",
    "Meanwhile, clean a glass slide with EtOH and allow to dry completely, then apply two layers of double-sided tape to the long sides of the slide.",
    "Only cover ~5 mm of the slide edge and shave off the overhanging tape using a razor blade.&nbsp;</p><p>3.",
    "Remove the coverslip using forceps and immediately wash with 95% EtOH.&nbsp;</p><p>4.",
    "Wash coverslip in filtered H2O for ~30s&nbsp;</p><p>5.",
    "Dry coverslip using compressed/forced air.&nbsp;</p><p>6.",
    "Spot beads onto coverslip:</p><p>a. Make high density bead solution by mixing 1 \u03bcl bead stock to 9 \u03bcl 1x Dulbecco's PBS (DPBS).",
    "Vortex and spin down.",
    "Apply a small droplet (~1 \u03bcL) to coverslip.&nbsp;</p><p><strong>Critical: </strong>Dulbecco's PBS must be used to prevent bead aggregation.&nbsp;</p><p>b.",
    "Make low density bead solution by adding 750 \u03bcl DPBS to dense bead working stock.",
    "Vortex.",
    "Apply a small droplet (~1 \u03bcL) to coverslip.&nbsp;</p><p>7.",
    "Quickly rinse off coverslip using filtered H2O for ~1 min.&nbsp;</p><p><strong>Critical</strong>:",
    "Allow water to flow in the direction away from sample so that beads do not wash into the sample.&nbsp;</p><p>8.",
    "Dry coverslip using forced air.&nbsp;</p><p>9.",
    "Place the dry coverslip tissue-side-down onto the slide with double sided tape.",
    "Avoid crooked placement.",
    "Use a pipette tip to apply pressure on the tape sides to seal the coverslip to the adhesive.&nbsp;</p><p>10.",
    "Prepare STORM imaging buffer and mix by gentle pipetting.",
    "Avoid forcing air into the solution.&nbsp;</p><p>11.",
    "Draw up 160 \u03bcl of the STORM buffer into a pipette and slowly release it in the space between the coverslip and slide.",
    "Avoid creating bubbles by applying gentle pressure to the coverslip with a blunt object.",
    "Avoid cracking the coverslip when doing this.&nbsp;</p><p>12.",
    "Lay a piece of foil on the benchtop and push some epoxy out of the double-barrel syringe onto the foil.",
    "Mix with a pipette tip.&nbsp;</p><p>13.",
    "Apply a strip of epoxy to all sides of the coverslip (short sides first) to seal the flow chamber.",
    "Place in a dark drawer to dry for ~5 mins.&nbsp;</p><p>14.",
    "Test that the epoxy created a seal around the flow chamber by applying gentle pressure with a pipette tip to the surface of the coverslip.",
    "If no buffer leaks, then the seal is good.",
    "If some buffer leaks, then patch the hole using more, freshly mixed epoxy.&nbsp;</p><p><strong>Critical: </strong>Be careful to not overapply epoxy and encroach on the sample area.&nbsp;</p><p>15.",
    "Apply a single strip of double-sided tape onto the short sides of the slide and trim off overhangs with razor blade.",
    "This is useful when securing slide to the STORM microscope.",
    "The preparation is ready for imaging.&nbsp;</p><p><br></p><p><strong>Acquire STORM and conventional imaging data&nbsp;(Timing: 1-3 hours to set up, 1-3 minutes per STORM movie (automated acquisition))</strong></p><p>",
    "The following steps describe our approach for collecting serial section conventional, wide-field (diffraction-limited) and STORM data, together with fiducial marker images for correcting chromatic aberration and uneven illumination of the sample.",
    "The key steps are to 1) collect conventional images of all color channels in rapid succession for the ROI(s) in each physical section of the sample.",
    "This limits sample drift between color channels for conventional images in each ROI.",
    "During subsequent image postprocessing/alignment, STORM images will be correlated to their conventional image counterparts to correct for sample drift.",
    "2) Collect STORM movies for ROI(s) across all physical sections.",
    "For each ROI, the red emitters (Dy749P1/Alexa647) are imaged first (sequentially within each ROI across the entire sample) as these dyes are susceptible to STORM buffer acidification (Dempsey et al., 2011).",
    "Then, Cy3B and Atto488 emitters are imaged sequentially for each ROI in a second image pass across the sample.",
    "Sample drift that occurs during each STORM movie acquisition is corrected as part of the single-molecule fitting analysis process by back correlating binned movie&nbsp;frames to the start of the movie.",
    "3) Collect fiducial marker images that will later be used to correct chromatic aberration in conventional and STORM images.&nbsp;</p><p><strong>Alternative: </strong>Commercial instrumentation and software may be used in lieu of custom instrumentation and the specific codebases we reference here.&nbsp;</p><p><br></p><p>1.",
    "Power on the microscope and lasers.&nbsp;</p><p>2.",
    "Clean the oil immersion objective prior to imaging and position 4x or 10x objective for tile imaging.&nbsp;</p><p>3.",
    "Secure the sample slide in the stage holder.&nbsp;</p><p><strong>Critical: </strong>Sample should be immobile once loaded in the stage.",
    "If necessary, use a top-side clamping stage insert or otherwise use double-sided tape applied to the glass slide to secure the specimen in the stage as described (previous section, step 15).&nbsp;</p><p>4.",
    "Launch \u2018Hal.py\u2019 acquisition software.&nbsp;</p><p><strong>",
    "Alternative: </strong>Use commercial image acquisition software provided by microscope vendor or alternative open-source hardware control software for image acquisition.&nbsp;</p><p>5.",
    "Load settings .xml",
    "files into Hal.py by dragging/dropping settings files into main Hal.py module or selecting \u2018File/load/settings\u2019 and then selecting desired settings files.&nbsp;</p><p>6.",
    "Engage the low magnification array setting in Hal.&nbsp;</p><p>7.",
    "Use the \u2018Illumination\u2019 control panel to engage the 561nm laser, locate the bead fields on the coverslip and focus the objective.&nbsp;</p><p>8.",
    "Use the \u2018Stage Control\u2019 panel to zero the stage position.&nbsp;</p><p>9.",
    "Create a low-magnification mosaic of the bead fields and sample (serial sections):&nbsp;</p><p><strong>Critical: </strong>Reduce laser power to low level to avoid image saturation and fluorophore bleaching.&nbsp;</p><p>a. Launch \u2018Steve.py\u2019 software and place cursor at or near the 0, 0 coordinates and press the spacebar to take an image.&nbsp;</p><p>b.",
    "Continue taking images of the field in manual or semi-automated modes:</p><p>i. manual imaging mode: click on an ROI and press the spacebar to take an image.&nbsp;</p><p>ii.",
    "semi-automated mode: click on an ROI and press keypad #3 or #9 for automated 3x3 or 9x9 image tiling, respectively.",
    "Press the spacebar to interrupt the sequence.&nbsp;</p><p><strong>Note: </strong>User may navigate the sample view in Steve.py by right-clicking on an ROI and selecting \u201cGo to Position.\u201d&nbsp;</p><p>c. Finish mosaic and save.",
    "Adjust the stage position back to the sparse bead field.&nbsp;</p><p>10.",
    "Create a high-magnification mosaic of the bead fields and sample (serial sections):</p><p>a. Position high-magnification oil/water objective (either 60x or 100x) for imaging.&nbsp;</p><p>b. Place a droplet of immersion oil on the objective (if using oil).&nbsp;</p><p>c. Focus on the sparse beads:</p><p>i. Engage the high magnification array setting in Hal.py.&nbsp;</p><p>ii.",
    "Using the \u2018Illumination\u2019 control panel in Hal.py, turn on a visible imaging laser (488nm or 561nm) and bring the sample into focus.&nbsp;</p><p>iii.",
    "Use the \u2018Focus lock\u2019 control panel to lock the focal plane.&nbsp;</p><p><strong>Alternative: </strong>Use commercial instrument with automated focus maintenance system and image tiling software to generate a low-mag and high-mag overview of the sample field and select ROIs for subsequent automated image acquisition.",
    "Alternative open-source software may also be used.&nbsp;</p><p>d. Set TIRF angle to maximize signal-to-noise at low illumination power.&nbsp;</p><p>e. Reimage selected regions (both sample and beads) of the low magnification mosaic at high magnification.&nbsp;</p><p><strong>",
    "Note: </strong>Steve.py allows users to correct offsets between low and high magnification by adjusting the mosaic positions within the \u2018Objective Settings\u2019 panel.&nbsp;</p><p>11.",
    "Select sample ROIs for automated imaging (manual):</p><p>a. Use mouse cursor to hover over ROI in first physical section.&nbsp;</p><p>b.",
    "Right click and select \u2018Record position\u2019.&nbsp;</p><p>c. Repeat for each ROI across the sample ribbon(s).&nbsp;</p><p>d.",
    "When all positions are selected, click \u2018File\u2019 and \u2018Save positions\u2019 to save a \u2018positions.txt\u2019 file.&nbsp;</p><p>e. Delete all recorded positions in Steve.py.&nbsp;</p><p><strong>Critical: </strong>Select ROIs in sequential order of physical sectioning to simplify downstream alignment processing.",
    "To prevent unwanted bleaching during acquisition of serial section images, select the order of ROIs to begin imaging the end of the sample ribbon at the furthest end of the coverslip in the direction of the TIRF beam.&nbsp;</p><p>12.",
    "Select bead ROIs for automated imaging (manual):</p><p>a. Use the mouse cursor to hover over ROIs in bead fields.&nbsp;</p><p>b.",
    "Starting in the sparse bead field, right click within a region away from the edge of the bead spot and select \u2018Record position\u2019.&nbsp;</p><p>c. Move cursor to new position within the bead spot (away from the edge and the first position), right click and select \u2018Record position\u2019.&nbsp;</p><p>d. Move cursor to center region of the dense bead field, right click and select \u2018Record position\u2019.&nbsp;</p><p>e.",
    "When positions are selected, click \u2018File\u2019 and \u2018Save positions\u2019 to save a \u2018bead_positions.txt\u2019 file.&nbsp;</p><p>13.",
    "Prepare illumination power settings for conventional image acquisition to ensure that images are not dim/saturated:</p><p>a. Engage the \u2018Conv\u2019 setting in Hal.py.&nbsp;</p><p>b. Focus on a representative ROI within the sample.&nbsp;</p><p>c. Adjust laser powers using the \u2018Illumination\u2019 control panel for each channel to be imaged.&nbsp;</p><p><strong>Critical</strong>:",
    "Avoid saturating dense bead images.",
    "Ensure sufficient illumination intensity to use the full dynamic range of the camera.&nbsp;</p><p>14.",
    "Prepare illumination power settings for sparse bead field image acquisition to ensure that images are not dim/saturated:</p><p>a. Engage the \u2018Regbeads\u2019 setting in Hal.py.&nbsp;</p><p>b. Focus on a representative ROI within the sparse bead field.&nbsp;</p><p>c. Adjust 750nm laser power using the \u2018Illumination\u2019 control panel to visualize IR beads in 750 and 647 channels.&nbsp;</p><p>d.",
    "Adjust 488nm laser power using the \u2018Illumination\u2019 control panel to visualize visible beads in the 647, 561, and 488nm channels.&nbsp;</p><p><strong>Critical</strong>:",
    "Avoid saturating sparse bead images.&nbsp;</p><p>15.",
    "Prepare illumination power settings for dense bead field image acquisition to ensure that images are not dim/saturated:</p><p>a. Engage the \u2018FFCbeads\u2019 setting in Hal.py.&nbsp;</p><p>b. Focus on a representative ROI within the dense bead",
    "field.&nbsp;</p><p>c. Adjust 750/647/561/488nm imaging laser powers using the \u2018Illumination\u2019 control panel to visualize dense beads in 750/647/561/488nm channels, respectively.&nbsp;</p><p><strong>Critical</strong>:",
    "Avoid saturating dense bead images.",
    "Ensure sufficient illumination intensity to use the full dynamic range of the camera.&nbsp;</p><p>16.",
    "Prepare illumination power settings for STORM image acquisition to optimize photoswitching and minimize movie length:</p><p>a. Engage the \u2018750STORM\u2019 setting in Hal.py.&nbsp;</p><p>b. Focus on a representative ROI within the sample.&nbsp;</p><p>c. Adjust the 750nm laser power to maximum and the 405nm laser to minimum using the \u2018Illumination\u2019 control panel.&nbsp;</p><p>d.",
    "In Hal.py, change the directory filename to \u2018750storm\u2019 and set the working directory to \u2018Acquisition\\create_xml\\powertest\\\u2019.&nbsp;</p><p>e. Set 'Mode\u2019 to \u2018Run_til_abort\u2019.&nbsp;</p><p>f.",
    "Click \u2018Record\u2019 to begin manual STORM movie acquisition.&nbsp;</p><p><strong>Note: </strong>Each wavelength-specific .xml file calls a preset shutter file that engages the appropriate imaging (750/647/561/488nm) and activation (405nm) lasers.&nbsp;</p><p>g. Manually ramp 405nm laser power using the \u2018Illumination\u2019 control panel to reactivate fluorophore switching to maintain optimal emitter density.&nbsp;</p><p>h. Pressing 'Stop\u2019 ends the movie recording and saves the power progression file.&nbsp;</p><p>i. Repeat steps 16 (a-h) for 647nm, 561nm, and 488nm STORM movies.",
    "Change the directory filenames for each movie according to wavelength using the format specified above.&nbsp;</p><p><strong>Note: </strong>Cy3B (561nm) and Atto488 (488nm) probes do not require 405nm illumination for reactivation.&nbsp;</p><p><strong>Alternative: </strong",
    ">The above steps 16 (a-i) describe the setting of custom \u2018power progression\u2019 files to control illumination settings during STORM movie acquisition.",
    "Hal.py also allows users to engage linear or exponential power ramping using the \u2018Progressions\u2019 control panel.&nbsp;</p><p>17.",
    "Begin automated image acquisition of all conventional, bead, and STORM files:</p><p>a.",
    "In main Hal.py interface, set working directory to local storage drive.&nbsp;</p><p><strong>Critical: </strong>Ensure local storage drive has sufficient capacity for image acquisition and/or set up automated transfer routine to clear drive of images following acquisition.",
    "Overfilling the drive will cause the acquisition control software to crash.&nbsp;</p><p",
    ">b. Adjust desired imaging parameters (e.g. number of frames, frame rate, focus lock position, illumination control, etc.) for multi-channel acquisition in a \u2018master.xml\u2019 file.&nbsp;</p><p>c. Launch \u2018Master_xml_generator.py\u2019.&nbsp;</p><p>d. Select the desired \u2018master.xml\u2019 file from Step B above (.xml format) containing imaging parameters.&nbsp;</p><p>e. Change file name and save out final \u2018master_run.xml\u2019 file.&nbsp;</p><p>f. Launch \u2018Dave.py\u2019",
    "software.&nbsp;</p><p>g. Click \u2018File/load\u2019 and select the \u2018master_run.xml\u2019 file for automated imaging.&nbsp;</p><p>h. Click \u2018Validate\u2019 to confirm the proper function of the automated image acquisition.&nbsp;</p><p>i. Select 'Run\u2019 to begin automated imaging.&nbsp;</p><p><strong>",
    "Alternative: </strong>Use commercial instrument with automated image acquisition software&nbsp;to set imaging parameters for selected ROIs.",
    "Alternative open-source software may also be used.&nbsp;</p><p><strong>Note: </strong>Adjust the total laser output power as needed to ensure optimal image quality during image acquisition.",
    "For conventional image acquisition this may require reducing laser output while for STORM movie acquisition power output should be increased to achieve sufficient density at the sample plane (1-3 kW/cm2).&nbsp;</p><p><br></p><p><strong>Process images to generate 3D volumes&nbsp;(Timing: varies (largely automated)&nbsp;</strong></p><p>",
    "The following steps convert raw conventional, bead, and STORM imaging data to final images.",
    "Steps include single-molecule fitting, drift/aberration corrections, and elastic registration of serial sections.",
    "Links to repositories hosting previously published and custom code (this paper) can be found in the \u2018Software and algorithms\u2019 section.</p><p><br></p><p>1.",
    "Download and install \u201cStorm-Analysis\u201d software.&nbsp;</p><p>2.",
    "Inspect raw .dax",
    "STORM movies in renderer software to determine frame range for single molecule fitting.&nbsp;</p><p>3.",
    "Adjust 3D-DAOSTORM SMLM fitting parameters (e.g. frame range, background, sigma, drift correction, etc.) in .xml files by manually inputting desired values.&nbsp;</p><p><strong>",
    "Note: </strong>",
    "We recommend testing fitting parameters on ~10 frames to view results of parameter settings before fitting the final number of desired frames.&nbsp;</p><p>4.",
    "Run SMLM fitting analysis (",
    "fully automated):</p><p>a. Open \u20181_batch_fitting.py\u2019 script.&nbsp;</p><p>b. Change working directory path to the location of the data to be analyzed (experiment folder).&nbsp;</p><p>c. Copy folder containing .xml and camera calibration files to the experiment folder.&nbsp;</p><p>d.",
    "Run script.&nbsp;</p><p><strong>",
    "Alternative: </strong>A list of available renderers and single-molecule fitting algorithms is referenced in the \u2018Software and algorithms\u2019 section.",
    "Use commercial or preferred open-source software to interact with raw SMLM data, generate SMLM localization lists, and convert these to image files.&nbsp;</p><p>5.",
    "Run single-section drift/chromatic aberration correction and alignment (fully automated):</p><p>a. Open \u20182_XY_alignment.py\u2019 script.&nbsp;</p><p>b. Change working directory paths to the experiment folder.&nbsp;</p><p>c. Run script.&nbsp;</p><p><strong>Alternative: </strong>Use commercial or other open-source software to correct sample drift for each ROI by cross-correlating each individual STORM image to its conventional image counterpart.",
    "Use the fiducial sparse bead field imaging data to generate a non-linear warping transform that registers beads across the color channels to correct chromatic aberration.",
    "Apply the resultant transform to all conventional and STORM images for each ROI.&nbsp;</p><p>6.",
    "Run 3D serial-section alignment (largely automated):</p><p>a. Open \u20183_Z_alignment.py\u2019 script.&nbsp;</p><p>b. Change working directory paths to the experiment folder.&nbsp;</p><p>c. Run script.&nbsp;</p><p>d.",
    "When the first FIJI subprocess launches, input rigid registration parameters to continue the alignment.&nbsp;</p><p>e.",
    "When the MATLAB subprocess opens, drag cursor within the displayed image to set a sample ROI for cropping the image stack.",
    "Right click and select \u2018crop\u2019 to continue the routine.&nbsp;</p><p>f.",
    "When the second FIJI subprocess launches, input elastic registration parameters to continue the alignment.",
    "Elastic alignment is implemented in TrakEM2 based on the original publication (Saalfeld et al., 2012).&nbsp;</p><p><strong>Alternative: </strong>Use alternative commercial or open-source software to perform 3D serial-section alignment.&nbsp;</p><p><strong>Note: </strong>We continue to develop and package these routines to improve functionality, ease of use, and open-source accessibility.",
    "Updates will be made available on GitHub.</p>"
]