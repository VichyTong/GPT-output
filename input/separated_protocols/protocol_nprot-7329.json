[
    "**Construction of MCAP vectors**",
    "_Small-scale cloning of crRNA arrays into MCAP expression vectors \\(4 days)_",
    "1. Identify target genes for knockout.",
    "Here we use Nf2 and Trim72 as illustrative examples, but note that any genomic loci with a Cpf1 PAM sequence \\(TTTV) may be targeted.\r\n  ",
    "2. Design LbCpf1 crRNAs \\(20-23nt spacers) with Benchling, Cas-Designer 15, or other computational tools.",
    "A non-targeting crRNA or control crRNA can also be included.\r\n  ",
    "LbCpf1 direct repeat \\(DR): TAATTTCTACTAAGTGTAGAT",
    "crNf2 spacer: AAGGCCTCGATCTCCGTCTT ",
    "crTrim72 spacer:  TGCCGTGCCTGCCTGATCCG",
    "3.",
    "Synthesize oligonucleotides according to the following schema, where the \u201ccore sequence\u201d is defined as Spacer1-DR-Spacer2-DR, and \u201crevComp\u201d denotes the reverse complement.",
    "Here, we use the crNf2 spacer as Spacer1, and crTrim72 spacer as Spacer2.\r\n  a) For cloning into pRC11: Forward oligo = TAGAT \u2013 core sequence \u2013 TTTTTTA; Reverse oligo = AGCTTAAAAAA \u2013 revComp\\(core sequence) \u2013 A. ",
    "b) For cloning into pRG01 and pRC49: Forward oligo = TAGAT \u2013 core sequence \u2013 T; Reverse oligo = AAAAA \u2013 revComp\\(core sequence) \u2013 A. ",
    "4.",
    "Anneal the forward and reverse oligos with the following reaction: \r\n  1 \u03bcl of 100 \u03bcM forward oligo",
    "1 \u03bcl of 100 \u03bcM reverse oligo",
    "1 \u03bcl of 10x T4 Ligation Buffer",
    "6.5 \u03bcl of ddH2O",
    "0.5 \u03bcl of T4 PNK",
    "Total vol = 10 \u03bcl. ",
    "Thermocycler conditions: 37\u00b0C for 30 minutes, 95\u00b0C for 5 minutes, then ramp down to 25\u00b0C at 5\u00b0C / minute.",
    "5.",
    "Digest pRC11 \\(puromycin resistance only), pRG01 \\(puromycin resistance and firefly luciferase), or pRC49 \\(puromycin resistance, firefly luciferase, and nuclear EGFP) with the following reaction:\r\n  5 \u03bcg of plasmid \\(pRC11, pRG01, or pRC49)",
    "3 \u03bcl of FastDigest Esp3I",
    "4 \u03bcl of FastAP",
    "5 \u03bcl of 10x FastDigest Buffer",
    "X \u03bcl of ddH2O to 50 \u03bcl",
    "Total vol = 50 \u03bcl. ",
    "Thermocycler conditions: 37\u00b0C for 30 minutes.",
    "6.",
    "Run the plasmid digestion on an agarose gel, alongside an uncut enzyme control.",
    "Confirm the linearization of the digested plasmid, then gel purify with the QIAquick Gel Extraction Kit.\r\n  ",
    "7. Dilute the annealed oligos from step 4 at 1:200 dilution in ddH2O.\r\n  8.",
    "Ligate the annealed oligos into the purified BsmBI-digested plasmid with the following reaction:\r\n  X \u03bcl of BsmBI-digested plasmid \\(from step 5) to 50 ng",
    "1 \u03bcl of diluted oligo duplex \\(from step 7)",
    "5 \u03bcl of 2x Quick Ligase Buffer",
    "1 \u03bcl of Quick Ligase",
    "X \u03bcl of ddH2O to 11 \u03bcl",
    "Total vol",
    "= 11 \u03bcl",
    "Incubate at room temperature for 10 minutes. ",
    "9. Transform into Stbl3 bacteria.",
    "On ice, add 1 \u03bcl of ligation product to bacteria and swirl gently to mix.",
    "Incubate on ice for 20 minutes, then heat shock by incubating at 42\u00b0C for 45 seconds.",
    "Immediately place bacteria back on ice and incubate for 20 minutes.",
    "Add 250 \u03bcl of S.O.C. media to bacteria, mix, and plate onto carbenicillin-containing LB agar plates.\r\n  ",
    "10.",
    "The following day, pick colonies and shake overnight in 4 mL of carbenicillin LB broth.\r\n  ",
    "11.",
    "Take 0.5 mL of the bacterial cultures and mix in 50% glycerol.",
    "Store in -20\u00b0C short-term, or -80\u00b0C long-term. \r\n  ",
    "12.",
    "Purify the plasmids from the remaining bacterial cultures with the QIAprep Spin Miniprep kit.\r\n  13.",
    "Sequence the plasmids with the following primer: GAGGGCCTATTTCCCATGAT.",
    "Confirm successful ligation of the oligos containing the crRNA array into the expression vector.\r\n  ",
    "_MCAP library design, cloning, and readout \\(4 days hands-on, not including chip oligo synthesis and next-generation sequencing)_",
    "1. Identify crRNA spacer sequences as described above for all genes to be represented in the library.",
    "Include control crRNA spacers that are non-targeting, or targeting a known control locus \\(i.e.",
    "noncoding regions or gene deserts).",
    "As a rule of thumb, the control crRNAs should ideally comprise at least 10% of the total library size in order to accurately model the null distribution.",
    "Since the cutting efficiencies of different crRNAs is quite variable, it is also essential to design multiple independent crRNAs targeting each gene.\r\n  ",
    "2.",
    "Here, we describe barcoded MCAP library design for double knockout studies, but we note that triple knockout studies are also feasible using this approach.",
    "Design MCAP library oligos according to the schema detailed below, where the \u201ccore sequence\u201d is defined as Spacer1-DR-Spacer2-DR, and \u201crevComp\u201d denotes the reverse complement.",
    "For each possible gene pair, randomly assign the constituent genes to either the first or second crRNA position.",
    "In our experience, the position of the crRNA within the array does not significantly influence Cpf1 cutting efficiency.\r\n  ",
    "For cloning into pRC11: ",
    "5\u2019 - TCTTGTGGAAAGGACGAAACACCGTAATTTCTACTAAGTGTAGAT \u2013 core sequence \u2013 TTTTTTNNNNNNNNNNAAGCTTGGCGTGGATCCGATATCAA - 3\u2019",
    " ",
    "b) For cloning into pRG01 or pRC49:",
    "5\u2019 - TCTTGTGGAAAGGACGAAACACCGTAATTTCTACTAAGTGTAGAT \u2013 core sequence \u2013 TTTTTTNNNNNNNNNNTTTTTTAAGCTTGGCGTGGATCCGATATCAA - 3\u2019",
    "3.",
    "Synthesize the MCAP library using an oligo pool service, such as CustomArray.\r\n  ",
    "4.",
    "PCR amplify the library using the following primers to add Gibson homology arms:\r\n  ",
    "arrayF_MCAP: TAACTTGAAAGTATTTCGATTTCTTGGCTTTATATATCTTGTGGAAAGGACGAAACACCG",
    "arrayR_MCAP: TTGTCTCAAGATCTAGTTGATATCGGATCCACGCCAAGCTT",
    "Use a 50 \u03bcl reaction volume. ",
    "Thermocycler conditions using Phusion Flash: 98\u00b0C for 1 min, 32 cycles of \\(98\u00b0C for 1s, 59\u00b0C for 5s, 72\u00b0C for 10s), 72\u00b0C for 2 min.",
    "5.",
    "Run the PCR product on a gel.",
    "The product should be 210 bp.",
    "Purify with the QIAquick Gel Extraction Kit.\r\n  6.",
    "Clone the purified PCR product into the appropriate vector by Gibson assembly according to manufacturer instructions.",
    "Use 330 ng of the digested vector and 50 ng of the PCR-amplified library pool.\r\n  ",
    "7.",
    "Using 1 \u03bcl of the Gibson product, electroporate the library into Endura ElectroCompetent cells according to manufacturer instructions.",
    "Use 1 vial of cells \\(split into two electroporations) for every 10,000 constructs represented in the library. \r\n  ",
    "8.",
    "After electroporation, recover the cells with 975 \u03bcl of Recovery Media.",
    "Transfer to a bacterial culture tube and shake at 37\u00b0C for 1.5 hours. \r\n  ",
    "9.",
    "Take 10 \u03bcl of the culture \\(from 1 mL total), dilute with 990 \u03bcl of LB with carbenicillin \\(1:100",
    "dilution).",
    "Then take 100 \u03bcl of the diluted cells and mix further with 900 \u03bcl of LB \\(1:1000 dilution).",
    "Plate 100 \u03bcl of the 1:1000 dilution on a small carbenicillin LB agar plate to calculate transformation efficiency.",
    "Plate the remaining cultures on large 245mm LB agar plates using a bacterial spreader. \r\n  ",
    "10.",
    "The following day, count the number of colonies on the small plate.",
    "Multiply the number of colonies by 10,000 to estimate the number of unique colonies represented in each of the large LB agar plates.",
    "The goal is to have approximately 500x the library size across all successfully transformed colonies. \r\n  ",
    "11.",
    "Add 10 mL of LB to the large plates, and harvest the cells with a cell spreader.",
    "Proceed with plasmid purification using the EndoFree Plasmid Maxi Kit.\r\n  12.",
    "Fully sequence the plasmid library by Illumina sequencing.",
    "To do so, PCR amplify the U6 expression cassette using the following primers:\r\n  ",
    "MCAP_rdt1_F: AATGGACTATCATATGCTTACCGTAACTTGAAAGTATTTCG",
    "MCAP_rdt1_R: CTTTAGTTTGTATGTCTGTTGCTATTATGTCTACTATTCTTTCCC",
    "Thermocycler conditions using Phusion Flash: 98 \u00b0C for 1 min, 15 cycles of \\(98 \u00b0C for 1s, 60 \u00b0C for 5s, 72 \u00b0C for 15s), and 72 \u00b0C for 1 min.",
    "13.",
    "Take 1 \u03bcl of the PCR product and amplify with a second round of PCR to add Illumina sequencing adapters. \r\n  ",
    "MCAP_rdt2_F: AATGATACGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTCTTCCGATCTTAAGTAGAGTCTTGTGGAAAGGACGAAACACCG",
    "MCAP_rdt2_R: CAAGCAGAAGACGGCATACGAGATAAGTAGAGGTGACTGGAGTTCAGACGTGTGCTCTTCCGATCTTTCTACTATTCTTTCCCCTGCACTGT",
    "Thermocycler conditions using Phusion Flash: 98 \u00b0C for 1 min, 20 cycles of \\(98 \u00b0C for 1s, 60 \u00b0C for 5s, 72 \u00b0C for 15s), and 72 \u00b0C for 1 min.",
    "14.",
    "Sequence the diluted libraries with 5-20% PhiX, with 150bp paired-end reads.\r\n  ",
    "15.",
    "Merge the raw paired-end fastq read files to single fastq files by PEAR with the settings -y 8G -j 8 -v 3. \r\n  16.",
    "Filter and demultiplex the merged fastq files using Cutadapt, using two different sets of adapters for extraction of crRNA array sequences or the 10mer barcode.",
    "For the crRNA array, use the following settings: cutadapt --discard-untrimmed -g tcttGTGGAAAGGACGAAACACCg, followed by cutadapt --discard-untrimmed -a TGTAGATTTTTTT. \r\n  ",
    "17.",
    "Map the trimmed sequences to the MCAP library using Bowtie: bowtie -v 3 -k 1 -m 1.",
    "For the 10mer degenerate barcodes, use the following Cutadapt settings: cutadapt --discard-untrimmed -a AAGCTTGGCGTGGATC, followed by cutadapt --discard-untrimmed -g TACTAAGTGTAGATTTTTTT. \r\n  18.  Quantify the resultant sequences to a reference of all possible 10mer sequences.",
    "Tabulate all reads that successfully mapped to both the MCAP library and contained a valid barcode.\r\n  ",
    "**Generating the MCAP-transduced cell pool**",
    "1.",
    "Grow HEK293FT cells to 80% confluency in 15-cm tissue culture dishes.",
    "One hour prior to transfection, change media to Opti-MEM.\r\n  2.",
    "Transfect HEK293FT cells with 20 ug MCAP lentiviral plasmid library, 10 ug pMD2.G, 15 ug psPAX2, and 1 ug pcDNA3-GFP, using polyethyleneimine \\(PEI).\r\n  ",
    "3. 6 hours following transfection, change media to DMEM with 10% FBS.\r\n  4.",
    "Collect supernatant at 48 and 72 hours after transfection.",
    "Centrifuge for 10 minutes at 1500g to remove cell debris.",
    "Freeze aliquots in -80\u00b0C.\r\n  5. Infect the target cells of interest using a variety of different lentiviral volumes.",
    "Add 3 \u03bcg/mL of puromycin 24 hours following lentiviral infection to select the transduced cells.",
    "Calculate the ratio of surviving cells after 24 hours of puromycin selection, compared to the initial cell count at time of infection.\r\n  ",
    "6.",
    "Once the lentiviral titer has been determined, infect the target cells at an MOI of 0.2, aiming for at least 1000x library coverage.",
    "As an example, for a library size of 10,000 arrays, infecting 1x108 cells at MOI of 0.2 will lead to ~2000x coverage.\r\n  ",
    "7.",
    "The following day, add 3 \u03bcg/mL of puromycin.",
    "Continue culturing the cells in puromycin-containing media for 7 days to ensure complete selection.\r\n  ",
    "**Mouse model of tumorigenesis and metastasis**",
    "1.",
    "Continuing with puromycin selection, expand the cell pool in 15 cm tissue culture plates until there are sufficient cells for experiments.",
    "For KPD cells, we inject 4\u00d710<sup>6</sup> cells per mouse, though the numbert of cells should be determined based on the cell type of interest.",
    "Once the required cell number has been reached, resuspend the cells to a final concentration such that each mouse will receive a 100 \u03bcl injection of the cell suspension.\r\n  ",
    "2. Anesthetize the mice according to animal protocol.",
    "For KPD cells, we inject 100 ul of the 4\u00d710<sup>7 cells / ml cell suspension \\(for a total of 4\u00d710</sup>6^ cells) into the right flanks of nu/nu mice. \r\n  ",
    "3.",
    "As the tumors engraft and begin to grow, measure tumor sizes by caliper approximately every two days.",
    "To calculate the tumor volume, use the formula Volume \\(mm<sup>3</sup>)",
    "= \u03c0/6**x**y*z.\r\n  ",
    "4. Euthanize mice at 28-35 days after the initial injection for KPD cells.",
    "For other cell types or starting cell numbers, the time of euthanization needs to be optimized for the emergence of metastasis.\r\n  ",
    "5.",
    "Harvest the primary tumors and lung lobes.",
    "Freeze in liquid nitrogen, then grind the tissue.\r\n  ",
    "6.",
    "Resuspend each sample in 6 ml of NK Lysis Buffer \\(50 mM",
    "Tris, 50 mM EDTA, 1% SDS, pH 8.0) supplemented with 30 \u03bcL of 20 mg/mL Proteinase K \\(Qiagen) in 15 mL conical tubes, and incubate at 55 \u00b0C bath overnight.\r\n  ",
    "7.",
    "Add 30 \u03bcl of 10 mg/mL RNAse and incubate at 37 \u00b0C for 30 min. Chill on ice, then add 2 mL of pre-chilled 7.5 M ammonium acetate. \r\n  ",
    "8.",
    "Invert, vortex for 30s, then centrifuge at 4,000g for 10 min. Decant supernatant into 15 ml tube, then add 6 ml 100% isopropanol.",
    "Invert 50 times and centrifuge at 4000g for 10 min. DNA should be visible as a small white pellet.\r\n  ",
    "9.",
    "Discard supernatant, add 6 ml of 70% ethanol, mix, then centrifuge at 4000g for 10 min. Discard supernatant, and remove residual ethanol by pipette.",
    "Air dry for 20 minutes. \r\n  ",
    "10.",
    "Resuspend DNA by adding 200-500 ul of ddH2O. Measure concentration by Nanodrop.",
    "Normalize to 1000 ng/\u03bcl for PCR.\r\n  ",
    "**MCAP library readout from tumor genomic DNA**",
    "1.",
    "For PCR readout from tumor genomic DNA, use 10-20 \u03bcg of gDNA per sample, divided over 5-10 replicate PCR reactions as necessary.",
    "For readout from the pre-injection cell pool, use 20 \u03bcg of gDNA divided over 10 replicate PCR reactions.\r\n  ",
    "2.",
    "For the 1st PCR, use the readout primers MCAP_rdt1_F and MCAP_rdt1_R as previously described for initial plasmid library sequencing.",
    "Thermocycler conditions using Phusion Flash: 98 \u00b0C for 1 min, 15 cycles of \\(98 \u00b0C for 1s, 60 \u00b0C for 5s, 72 \u00b0C for 15s), and 72 \u00b0C for 1 min. \r\n  3.",
    "Pool together 1st PCR products from each biological replicate.",
    "Take 2 \u03bcl of the mixed 1st PCR products as the template for 2nd round PCR, using the barcoded primers detailed in \"Table 1\":http://www.nature.com/protocolexchange/system/uploads/7577/original/Table1-readout-primers.xlsx?1550119626 to uniquely label each independent sample.",
    "Note down the barcoding scheme for each sample.",
    "Thermocycler conditions using Phusion Flash: 98 \u00b0C for 1 min, 15 cycles of \\(98 \u00b0C for 1s, 60 \u00b0C for 5s, 72 \u00b0C for 15s), and 72 \u00b0C for 1 min.\r\n  4.",
    "Quantify 2 ul of the 2nd PCR products on a 2% E-gel EX using the E-Gel Low Range Quantitative DNA Ladder.",
    "Use these quantities to equally mix the 2nd PCR products of each sample.",
    "Purify using the QIAquick PCR Purification Kit as well as the Gel Extraction Kit. \r\n  ",
    "5. Sequence the diluted libraries with 5-20% PhiX, with 150bp paired-end reads.\r\n  ",
    "**Analysis of MCAP library readout**",
    "1.",
    "Use PEAR 16 to merge paired-end fastq files. \r\n  ",
    "2.",
    "Filter and demultiplex using Cutadapt 17.  ",
    "To remove extra sequences downstream \\(i.e.",
    "3\u2019 end) of the crRNA array sequences, including the DR and U6 terminator, execute the following command: cutadapt --discard-untrimmed \u2013e 0.1 -a aagcttggcgtGGATCCGATATCa -m 80. \r\n  3.",
    "As the forward PCR primers used to readout crRNA array representation were designed to have a variety of barcodes to facilitate multiplexed sequencing, demultiplex these filtered reads with the following settings: cutadapt -g file:fbc.fasta --no-trim, where fbc.fasta contains the 12 possible barcode sequences within the forward primers noted in Table 1. \r\n  ",
    "4.",
    "To remove extraneous sequences upstream \\(i.e.",
    "5\u2019 end) of the crRNA array spacers, run this command: cutadapt --discard-untrimmed \u2013e 0.1 -g tcttGTGGAAAGGACGAAACACCg",
    "-m 80. \r\n  ",
    "5.",
    "Remove the 5\u2019 DR sequence as follows: cutadapt --discard-untrimmed -e 0.1 -g TAATTTCTACTAAGTGTAGAT",
    "-m 80. \r\n  ",
    "6.",
    "Map the filtered fastq reads to the MCAP-MET reference index.",
    "To do so, first generate a Bowtie index of the MCAP-MET library using the bowtie-build command in Bowtie 1.1.2 18.",
    "Using these bowtie indexes, map the filtered fastq read files using the following command bowtie -n 2 -k 1 -m 1 --best.",
    "These settings ensure that only single-match reads would be retained for downstream analysis. \r\n  ",
    "7.",
    "For data processing on the level of barcoded-crRNAs, we utilized the same trimmed fastq files as above, but instead used the barcoded-crRNA plasmid library \\(described above) as the reference Bowtie index.\r\n  ",
    "8. Tabulate the number of reads that had mapped to each crRNA array within the library using the Bowtie mapping output.",
    "Normalize the number of reads in each sample by converting raw crRNA array counts to reads per million \\(rpm).\r\n  ",
    "9.",
    "To analyze the data at the level of barcoded-crRNAs, convert the counts per barcoded-crRNA in each sample to percentages of total reads.\r\n  10.",
    "To identify crRNA arrays that are enriched in individual samples, utilize the control crRNA arrays to model the empirical null distribution.",
    "Enriched crRNA arrays can be defined as those exceeding the abundance of the \u201ctop\u201d control crRNA. \r\n  ",
    "11.",
    "For identifying potential synergistic interactions, calculate the synergy coefficient \\(SynCo) for each gene pair with the following formula: SynCo = DKONM - SKO\u00acN- SKOM.",
    "The DKONM value is the median log2 rpm abundance \\(averaged over all samples) of all corresponding DKO crRNA arrays \\(i.e., crN.crM), while SKO\u00acN and SKOM values are defined as the median log2 rpm abundance of all corresponding SKO crRNA arrays.",
    "By this definition, a SynCo score > 0 would indicate that a given DKO crRNA array is synergistic, as the DKO score would thus be greater than the sum of the individual SKO scores.\r\n  ",
    "**Validation of individual genes and pairs**",
    "1.",
    "Having identified potential genetic interactions from the primary tumors and/or metastases, validation experiments using individual crRNA arrays can be performed.",
    "Use the oligo-cloning protocol described above to clone in the specific crRNA arrays of interest.\r\n  ",
    "2.",
    "The in vivo tumor model can be performed similarly.",
    "We inject 1.8x106 KPD cells per flank, as the cells all contain the same crRNA array and do not necessitate larger cell numbers to accommodate library diversity.\r\n  ",
    "3. Proceed with tumor growth measurements and tissue dissection procedures as done previously.\r\n  ",
    "**T7E1 assays**",
    "1. 7 days following the initial lentiviral infection, harvest the puromycin-resistant cells and isolate genomic DNA using the QIAamp DNA Mini Kit.\r\n  2.",
    "Design PCR primers to amplify target loci from genomic DNA around cutting site.",
    "Input the crRNA spacer sequence into NCBI Blat, then click \u201cView->Get DNA.\u201d",
    "Retrieve the 600 bp of DNA sequence upstream and downstream of the crRNA cut site within the genome.\r\n  ",
    "3. Copy the ~1200 bp sequence into NCBI Primer-BLAST.",
    "Make sure to select the Refseq representative genome for the correct organism of interest under the \u201cPrimer Pair Specificity Checking Parameters\u201d section.",
    "Other parameters such as melting temperature, oligo length, and PCR product size can be optimized as desired.\r\n  ",
    "4.",
    "Using the primers designed from step 3, Perform PCR on the isolated genomic DNA.",
    "Run PCR amplicons on 2% E-gel EX and purify \\(with known band size) using QIAquick Gel Extraction Kit.\r\n  5.",
    "After purification, denature and anneal 200 ng of purified PCR product in NEB Buffer 2 according to the manufacturer protocol, then digest with T7E1 at 37\u00b0C for 45min.\r\n  ",
    "6.",
    "Load digested PCR products into 2% E-gel EX and quantify DNA fragment abundance using E-Gel\u2122 Low Range Quantitative DNA Ladder \\(ThermoFisher).",
    "Calculate the mutation frequency using the formula: 100 x \\(1 \u2013 \\(1- fraction cleaved)<sup>1/2</sup>).\r\n  ",
    "**Next-generation sequencing analysis of indels**",
    "1.",
    "Using the PCR primers designed above for T7E1, the indel frequency can additionally be determined by next-generation sequencing.\r\n  ",
    "2. Dilute the PCR amplicons and prepare sequencing libraries using the Nextera XT kit.\r\n  ",
    "3.",
    "Sequence using paired-end reads on an Illumina sequencer.\r\n  ",
    "4.",
    "Map paired reads to the reference genome \\(expected sequences provided in FASTA form to generate indices) using BWA-MEM 19 with the command: bwa mem -t 8 -w 200.\r\n  ",
    "5. Run VarScan20 v2 using the pileup2indel command, which utilizes Samtools mpileup 21.  \r\n  ",
    "6.",
    "Filter indels to those that occur within a \u00b1 7 bp window around the predicted cut site.\r\n  ",
    "7. Sum the variant frequencies of the filtered indels to determine the indel frequency."
]