[
    "<p><strong>Experimental design</strong></p><p>A clear definition of the scientific question driving genome-wide transcriptional profiling remains the key factor to ",
    "Determine the optimal experimental design.</p><p>A crucial point is the specification of the number of biological replicates to ",
    "Ensure sufficient statistical power.",
    "The optimal number of replicates depends mainly on the magnitude of differential expression (effect size) and the complexity of experimental ",
    "Design (number of covariates).",
    "However, as described in Alpern et al. article<sup>9</sup>, shifting from 20 to 5 replicates greatly reduces the ability to detect true differentially expressed genes (DEGs) (decrease statistical power).",
    "The low cost per sample is a great advantage for increasing the number of samples in an analysis and allows a high performance to detect DEGs.</p><p>",
    "In order to avoid batch effects, RNA extraction series have to be randomized according to biological conditions.",
    "A randomization of the samples on micro-well plates is also necessary to avoid rows/columns batch effects; we have developed an <a href=\"https://gitlab.univ-nantes.fr/pierre.lindenbaum/plate-optimizer\" rel=\"noopener noreferrer\" target=\"_blank\">algorithm to randomize samples</a>.</p><p>&nbsp;</p><p><strong>Sample qualification</strong></p><p>Libraries are prepared from 10ng of total RNA per sample, diluted in 4\u00b5l of RNase free water.",
    "RNA concentration and purity are measured on NanoDrop station (ThermoFisher scientific); OD 260/230 ratios should be around 1.8 - 2.0 to ",
    "Ensure that concentration is properly assessed.",
    "Quality of RNA samples is controlled on 2100 Bioanalyzer system (Agilent) with RNA 6000 Nano Kit (ref 5067-1511, Agilent).</p><p><br></p><p><strong>",
    "Library preparation</strong></p><p>Library construction (Fig.2) for 3\u2019SRP is performed according to Soumillon&nbsp;et al.<sup>1</sup>&nbsp;</p><p>",
    "The mRNA poly(A) tails are tagged with universal adapters, well-specific barcodes and unique molecular identifiers (UMIs) during template-switching reverse&nbsp;transcription: 96 RNA samples are distributed in a MicroAmp Optical 96-well Reaction Plate (ref N8010560, Applied Biosystems) with 1\u00b5l of&nbsp;well-specific barcoded adapter E3V6NEXT (10\u00b5M, Integrated DNA Technologies) .</p><p><br></p><p><em",
    ">E3V6NEXT = 5'-/5Biosg/ACACTCTTTCCCTACACGACGCTCTTCCGATCT[BC6]N10T30VN-3'</em></p><p><em>5Biosg = 5\u2019 biotin,</em></p><p><em>[BC6] = 6bp barcode specific to each cell/well,</em></p><p><em>N10 = Unique Molecular Identifiers</em></p><p>&nbsp;</p><p>Template-switching reverse transcription was performed using Maxima H Minus Reverse Transcriptase (ref EP0753, Life technologies), Deoxynucleotide (dNTP)",
    "Solution Mix (ref N0447L, New England Biolabs) and with universal adapter E5V6NEXT (100\u00b5M, Integrated DNA Technologies).",
    "No RNA Spike-in was used in our approach.</p><p><br></p><p><em>E5V6NEXT = 5\u2019-/5Me-isodC//iisodG//iMe-isodC/ACACTCTTTCCCTACACGACGCrGrGrG-3\u2019</em></p><p><br></p><p>All 96 cDNAs obtained after template-switching reaction are pooled together, purified and concentrated with single DNA &amp; Concentrator-5 column (ref ZD4013, Ozyme).",
    "Pooled and concentrated cDNAs are treated with Exonuclease I (M0293S/L, New England Biolabs) and then amplified by single primer PCR using Advantage\u00ae 2 PCR Kit (ref 639206, Ozyme) and SINGV6 primer (10\u00b5M, Integrated DNA Technologies) :",
    "</p><p><br></p><p><em>SINGV6 = 5\u2019-/5Biosg/ACACTCTTTCCCTACACGACG*C-3\u2019</em></p><p><br></p><p>12 cycles of PCR amplification are applied.",
    "PCR products are purified with Agencourt&nbsp;AMPure",
    "XP magnetics beads [0.6x] (ref A63881, Beckman Coulter) and quantified spefically for dbDNA on Varioskan\u2122 LUX (ThermoFisher scientific) with QUANT-IT dsDNA assay kit (ref Q33130, ThermoFisher scientific).</p><p>Tagmentation has been adapted from the original protocol.",
    "Amplified barcoded cDNAs are tagmented using a bead-linked transposome (Illumina).",
    "Between 100 and 200ng of full-length cDNAs was used as in",
    "Put to the Nextera\u2122 DNA Flex Library Prep kit (ref #20018704, Illumina) and Nextera\u2122 DNA CD Indexes (24 Indexes, 24 Samples) (ref #20018707, Illumina) according to the manufacturer\u2019s protocol (Nextera DNA Flex Library Document, ref #1000000025416 v04, Illumina) with exception that :</p><p><br></p><p><em>- the i5 primer was replaced by P5NEXTPT5 primer (5\u00b5M, Integrated DNA Technologies)</em></p><p><em>P5NEXTPT5 = 5\u2019-AATGATACGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTCTTCC*G*A*T*C*T*-3\u2019 </em></p><p><em>where *",
    "= phosphorothioate bonds</em></p><p><em>- number of PCR cycles was defined at 8</em></p><p><em>- final elution of purified library was realized in 15\u00b5l of RSB (Resuspension Buffer - included Nextera\u2122 DNA Flex Library Prep kit, Illumina)</em></p><p><br></p><p><strong>Library quantification</strong></p><p>The size of the resulting sequencing library was controlled on a 2200 Tape Station (Agilent) with High Sensitivity D1000 ScreenTape (ref 5067- 5584, Agilent) and High Sensitivity D1000 Reagents (ref 5067- 5585, Agilent).",
    "Expected size of library is between 400 and 800pb.</p><p>Library is specifically P5-P7 quantified by qPCR on Light Cycler 480 (Roche) according to standards Lib Quant Standards (Illumina) (ref 07960387001, Roche).",
    "P5 and P7 primers (100\u00b5M, Eurofins) are added to Master Mix of kit Kapa&nbsp;Sybr",
    "Fast LC480 (ref KK4611, Sigma-Aldrich).</p><p><br></p><p><em>P5 = 5'-AATGATACGGCGACCACCGAGAT-3'</em></p><p><em>P7 = 5'-CAAGCAGAAGACGGCATACGA-3'</em></p><p><br></p><p>",
    "The final concentration must be greater than 2nM in 10\u00b5l (for HiSeq sequencing) or greater than 15nM in 10\u00b5l (for NovaSeq sequencing) to be sequenced.</p><p><br></p><p><strong>Sequencing</strong></p><p>Libraries are sequenced either on an Illumina&nbsp;HiSeq 2500 using a Hiseq Rapid SBS Kit v2-50 cycles (ref FC-402-4022) and a Hiseq Rapid PE Cluster Kit v2 (ref PE-402-4002) with 16-58 cycles reads according to manufacturer\u2019s protocol (Denaturing and Diluting Libraries for the HiSeq\u00ae and GAIIx, Part # 15050107v03, Illumina), or on a NovaSeq 6000 using NovaSeq 6000",
    "SP Reagent Kit 100 cycles (ref #20027464, Illumina) with 17-8-105 cycles reads (Illumina recommends to ",
    "Add one cycle for reads 1 and 3 on NovaSeq sequencing) according to the manufacturer\u2019s protocol (NovaSeq 6000 Sequencing System Guide Document #1000000019358v11 Material #20023471, Illumina).",
    "i7 indexes are ",
    "Read on NovaSeq sequencing due to injection of two plates of 96 libraries on a SP Flow Cell.</p><p><br></p><p>Raw fastq pairs used for analysis matched the following criteria:</p><p>- the 16 bases of the first ",
    "Re",
    "Move any poly A tail, which can occur when the transposase cuts a DNA fragment in ",
    "Close proximity to the poly A tail.",
    "By using cutadapt on these fragments, all the bases following the poly A tails (reverse sequences of the UMI, sample barcode and illumina adapter) are also removed.</p><p>- The cDNA sequences from each sample are then aligned on the reference transcriptome and the mitochondrial genomic reference ",
    "Sequence with BWA<sup>5</sup> aligner.",
    "Since a reference transcriptome is used, there is no need for RNA aligner (such as STAR or bowtie).</p><p>- Expression profiles are generated by parsing the alignment files (bam) then counting the number of unique UMIs associated with each gene for each sample.</p><p>- Reads are removed if one of the following cases occur:</p><p>*",
    "the UMI contains 'N's in its sequence.</p><p>* there are more than 3 mismatches in the alignment.</p><p>*",
    "the ",
    "Sequence aligns with the same score on transcripts of more that one gene.</p><p>- Finally, the raw expression matrix is produced, which contains the values of abundance for every gene in all samples.</p><p>&nbsp;</p><p><strong>Secondary Analysis</strong></p><p>The secondary analysis consists in identifying the differentially expressed genes between conditions from the raw expression matrix.</p><p>The pipeline is mainly written in the R programming language.</p><p>- Samples and genes are filtered out of the raw expression matrix according to the parameters specified in the configuration file:</p><p>*",
    "Samples are removed if they have less than --minReads reads assigned (default 200k) or if they have less than --minGenes genes detected (i.e. number of genes with at least 1 count) (default 5k).</p><p>*",
    "Genes are removed if not detected (counts = 0) in at least the number of samples forming the smallest condition.</p><p>- Counts are then normalized by DESeq2<sup>6</sup> method.</p><p>- Differentially expressed genes are found by DESeq2.",
    "By default, genes with an adjusted p-value &lt; 0.05 and a log2 fold-",
    "Change &gt; 0.58 (i.e. fold-",
    "StringDB networks are shown if the number of differentially expressed genes is below 50.</p><p><br></p><p><br></p><p><strong><em><u>Running the 3\u2019SRP pipeline</u></em></strong></p><p>",
    "The pipeline is entirely implemented as a <a href=\"https://gitlab.univ-nantes.fr/bird_pipeline_registry/srp-pipeline\" rel=\"noopener noreferrer\" target=\"_blank\">Snakemake workflow</a>.",
    "Scripts used in the pipeline are mainly written in the python and R programming language.</p><p><br></p><p><strong>Requirements</strong></p><p>Installing git and conda are mandatory before running the pipeline.</p><p>All necessary tools are then listed within a conda environment recipe.",
    "This environment can be created with a basic conda command.</p><p>-----</p><p><em>$ conda&nbsp;env create -n srp -f CONDA/srp.yml</em></p><p>-----</p><p><br></p><p><strong>Testing the installation</strong></p><p>A minimal sample size test data as well as a sample&nbsp;sheet are available in the \"TESTDATA\" folder.",
    "In order to ",
    "Check the installation, ",
    "Run the pipeline on this data.</p><p>This test data is made up of six samples classified in three conditions (2 samples per condition).",
    "The fastq files are real reads taken on a small portion of the human chromosome 22.",
    "The reference is a fasta file of the human chromosome 22.</p><p>-----</p><p><em>$&nbsp;conda activate srp</em></p><p><em># Under the srp-pipeline directory:</em></p><p><em>$ python SCRIPTS/make_srp_config.py -s",
    "TESTDATA/samplesheet.tsv -r",
    "TESTDATA/REFERENCES/ -w RESULTS -f",
    "TESTDATA/fastqFiles.txt -c TESTDATA/conditions.tsv --minGenes 0",
    "--minReads 0 &gt; config.json</em></p><p><em>$ snakemake --config&nbsp;conf=\"config.json\"",
    "-rp -j",
    "1</em></p><p>-----</p><p><br></p><p><strong>In",
    "Put files</strong></p><p>The pipeline takes as in",
    "This file has to be tab delimited (without header) containing six columns: well, index, name, project, condition, species.</p><p><br></p><p><strong>--The fastq&nbsp;files :</strong></p><p>",
    "The fastq files have to be in paired-end mode.",
    "The first file should contain the sequences of the sample indexes as well as the unique molecule identifiers (UMI) (6+10 bases).",
    "The second file should contain the DNA sequences of the captured polyA RNAs (N bases).",
    "There are two ways of specifying the fastq files to the program:</p><p>- Creating a file listing the fastq paths</p><p>-",
    "Specifying a Illumina directory (bcl2fastq out",
    "Put folder)</p><p><br></p><p><strong>--The comparisons file :&nbsp;</strong></p><p>",
    "In order to ",
    "Perform secondary analysis for all or some projects, a file listing the project name and comparisons has to be create.</p><p><br></p><p><strong>Running the pipeline</strong></p><p><strong><em>1- Clone this repository and ",
    "Move to it</em></strong></p><p>-----</p><p><em>$ git&nbsp;clone \"https://gitlab.univ-nantes.fr/bird_pipeline_registry/srp-pipeline.git\"</em></p><p><em>$ cd srp-pipeline</em></p><p>-----</p><p><strong><em>2- Activate the conda environment</em></strong></p><p>----</p><p><em>$ conda activate srp</em></p><p>----</p><p><strong><em>3- Create the configuration file necessary for the pipeline.",
    "<",
    "/em></strong></p><p>",
    "The script used to create the configuration file is make_srp_config.py in the SCRIPTS folder.",
    "The help can be visualized with:</p><p>----</p><p><em>$ python SCRIPTS/make_srp_config.py -h</em></p><p>----</p><p",
    ">",
    "The mandatory options are <strong>-s for the samplesheet</strong>, either <strong>-f for a file</strong> listing the fastq paths or <strong>-i for an illumina directory</strong> and <strong>-r for the directory containing the genome files</strong> for the different assemblies.</p><p>It is recommended to specify a working directory where the files will be <strong>out",
    "Put with option -w</strong> to ",
    "Keep the srp-pipeline git clone clean.",
    "The program outputs a json object on stdout which can be redirected to a file.</p><p>----</p><p><em>$ python SCRIPTS/make_srp_config.py -s &lt;my_samplesheet&gt; -r &lt;path_to_reference_folder&gt; -w &lt;path_to_workdir&gt; -i &lt;path_to_fastqs&gt; &gt; config.json</em></p><p>----</p><p>For secondary analysis, use <strong>option -c</strong> to specify the comparisons to perform.</p><p>----</p><p><em>$ python SCRIPTS/make_srp_config.py -s &lt;my_samplesheet&gt; -r &lt;path_to_reference_folder&gt; -w &lt;path_to_workdir&gt; -i &lt;path_to_fastqs&gt; -c &lt;comparisons_file&gt; &gt; config.json</em></p><p>----</p><p>The generated configuration file should be checked to ",
    "See if everything seems alright.</p><p>----</p><p><em>$ cat&nbsp;config.json</em></p><p>----</p><p><strong><em>4-",
    "Launch the snakemake pipeline.</em></strong></p><p>Test the launch with a <strong>",
    "Dry run</strong>:</p><p>----</p><p><em>$ snakemake --config&nbsp;conf=\"config.json\" -rpn</em></p><p>----</p><p>All rules and commands that will be ",
    "Run should be displayed.",
    "Otherwise errors are returned.</p><p>Launch the run:</p><p>----</p><p><em>$ snakemake --config&nbsp;conf=\"config.json\" -rp -j 1</em></p><p>----</p><p>",
    "In order to launch the pipeline <strong>on a cluster</strong>, specify a script to encapsulate the jobs to snakemake.",
    "example for SGE:</p><p>----</p><p><em>$ snakemake --config&nbsp;conf=\"config.json\" --cluster \"qsub -e",
    "./logs/",
    "-o",
    "./logs/\" -j",
    "33 --jobscript SCRIPTS/sge.sh --latency-",
    "Wait 100 -rp&nbsp;</em></p><p>----</p>"
]